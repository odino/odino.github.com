
<!doctype html>
<!-- BEGIN _layouts/default.html -->
<html>
	<head>
		<meta charset="utf-8">
		
		<meta content="A brief introduction to Make and Makefiles, one of Linux's true gems." name="description">
		<meta content="Alessandro Nadalin" name="author">
		
		<title>Makefile 101</title>
		<meta name="google-site-verification" content="dSNHLHJFQzKASjN8qHJisk2XLkKqbF_ilGSj9bscwKs" />
		<link href="/favicon.png" rel="icon">
		<link href="/stylesheets/screen.css" rel="stylesheet">
		<link href="/atom.xml" rel="alternate" title="Alessandro Nadalin" type="application/atom+xml">
		<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" type="text/css" href="/MyFontsWebfontsKit.css">

		<meta name="twitter:card" content="summary" />
		<meta name="twitter:creator" content="@_odino_" />
		<meta property="og:url" content="https://odino.org/makefile-101/" />
		<meta property="og:title" content="Makefile 101" />
		<meta property="og:description" content="A brief introduction to Make and Makefiles, one of Linux's true gems." />
		
	</head>
	<body>
		<div class="wrap">
			<header>
				<div class="navi">
					<ul>
                        <li><a href="/"><i class="icon-home icon-large"></i> Home</a></li>
                        <li><a href="/about"><i class="icon-user icon-large"></i> About</a></li>
                        <li><a href="/conferences"><i class="icon-group icon-large"></i> Conferences</a></li>
                        <li><a href="/archives"><i class="icon-briefcase icon-large"></i> Archives</a></li>
                        <li><a href="/atom.xml"><i class="icon-rss icon-large"></i> RSS</a></li>
					</ul>
				</div>
			</header>
			<!-- BEGIN _layouts/post.html -->

    <header>
        <h1><a href="/makefile-101/">Makefile 101</a></h1>
        <time>15 June 2018</time>
        <!-- 
        
        
        
          <br />
          <time>(note: this post was written 4 years ago and might be outdated)</time>
         -->
    </header>
<div class="entry-content "><p>It seems like developers are afraid of using <code>make</code> as they link it to the painful
experience of compiling things from scratch &mdash; the dreaded <code>./configure &amp;&amp; make &amp;&amp; make install</code>.</p>

<p>Part of this fear is due to the description of what <a href="https://linux.die.net/man/1/make">make(1)</a>
does:</p>

<blockquote><p>The purpose of the make utility is to determine automatically which pieces of a large program need to be recompiled, and issue the commands to recompile them.</p><footer><strong>Free Software Foundation</strong> <cite><a href='https://linux.die.net/man/1/make'>The Linux Man Pages</a></cite></footer></blockquote>


<p>Not everyone is aware that make can be easily
used to manage tasks in your projects, so I wanted to share a brief introduction
ad how <a href="https://github.com/odino/mssqldump/blob/master/Makefile">Makefiles help me automate some tasks</a>
in my day to day activities: this brief guide will focus on using make as an
automation tool for tasks rather than a tool for compiling code.</p>

<!-- more -->


<h2>Executing tasks&hellip;</h2>

<p>Let&rsquo;s start by simply creating a <code>Makefile</code>, and defining a task to run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>task:
</span><span class='line'>  date</span></code></pre></td></tr></table></div></figure>


<p>If you run <code>make task</code> you will bump into the following error:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/tmp ᐅ make task
</span><span class='line'>Makefile:2: *** missing separator.  Stop.</span></code></pre></td></tr></table></div></figure>


<p>and that&rsquo;s because Makefiles use tabs to indent code. Let&rsquo;s update our example by
using tabs rather than spaces and&hellip;   &hellip;voila:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/tmp ᐅ make task
</span><span class='line'>date
</span><span class='line'>Fri Jun 15 08:34:15 +04 2018</span></code></pre></td></tr></table></div></figure>


<p>What kind of sorcery is this? Well, <code>make</code> understood you wanted to run the section
<code>task</code> of your makefile, and ran the code (<code>date</code>) within that section in a shell,
outputting both the command and its output. If you want skip outputting the command
that&rsquo;s being executed you can simply prefix it with an <code>@</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>task:
</span><span class='line'>  @date</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/tmp ᐅ make task
</span><span class='line'>Fri Jun 15 08:34:15 +04 2018</span></code></pre></td></tr></table></div></figure>


<p>The first task in a <code>Makefile</code> is the <em>default</em> one, meaning we can run <code>make</code>
without any argument:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/tmp ᐅ make       
</span><span class='line'>Fri Jun 15 08:37:11 +04 2018</span></code></pre></td></tr></table></div></figure>


<p>You can add additional tasks in your <code>Makefile</code> and call them with <code>make $TASK</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>task:
</span><span class='line'>  @date
</span><span class='line'>some:
</span><span class='line'>  sleep 1
</span><span class='line'>  echo "Slept"
</span><span class='line'>thing:
</span><span class='line'>  cal</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/tmp ᐅ make thing
</span><span class='line'>cal
</span><span class='line'>     June 2018        
</span><span class='line'>Su Mo Tu We Th Fr Sa  
</span><span class='line'>                1  2  
</span><span class='line'> 3  4  5  6  7  8  9  
</span><span class='line'>10 11 12 13 14 15 16  
</span><span class='line'>17 18 19 20 21 22 23  
</span><span class='line'>24 25 26 27 28 29 30  </span></code></pre></td></tr></table></div></figure>


<h2>&hellip;in a specific order</h2>

<p>A lot of times you will want to execute a task before the current one &mdash; think of
it as <code>before</code> or <code>after</code> hooks in your automated tests. This can be done by specifying
a list of tasks right after your task&rsquo;s name:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>task: thing some
</span><span class='line'>  @date
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/tmp ᐅ make task
</span><span class='line'>cal
</span><span class='line'>     June 2018        
</span><span class='line'>Su Mo Tu We Th Fr Sa  
</span><span class='line'>                1  2  
</span><span class='line'> 3  4  5  6  7  8  9  
</span><span class='line'>10 11 12 13 14 15 16  
</span><span class='line'>17 18 19 20 21 22 23  
</span><span class='line'>24 25 26 27 28 29 30  
</span><span class='line'>
</span><span class='line'>sleep 1
</span><span class='line'>echo "Slept"
</span><span class='line'>Slept
</span><span class='line'>Fri Jun 15 08:40:23 +04 2018</span></code></pre></td></tr></table></div></figure>


<h2>Variables</h2>

<p>Defining and using variables is fairly straightforward:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>VAR=123
</span><span class='line'>
</span><span class='line'>print_var:
</span><span class='line'>        echo ${VAR}
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/tmp ᐅ make print_var    
</span><span class='line'>echo 123
</span><span class='line'>123</span></code></pre></td></tr></table></div></figure>


<p>but watch out as your shell variables won&rsquo;t work out of the box:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>print_user:
</span><span class='line'>        echo $USER</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/tmp ᐅ make print_user   
</span><span class='line'>echo SER
</span><span class='line'>SER</span></code></pre></td></tr></table></div></figure>


<p>as you will need to escape them with either <code>${VAR}</code> or <code>$$VAR</code>.</p>

<p>Passing flags is also a bit different from what you might be used to &mdash; they&rsquo;re
positioned as flags but use the same syntax as environment variables:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>print_foo:
</span><span class='line'>  echo $$FOO</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/tmp ᐅ make print_foo
</span><span class='line'>echo $FOO
</span><span class='line'>
</span><span class='line'>/tmp ᐅ make print_foo FOO=bar
</span><span class='line'>echo $FOO
</span><span class='line'>bar</span></code></pre></td></tr></table></div></figure>


<h2>The shell</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>5.3.1 Choosing the Shell
</span><span class='line'>------------------------
</span><span class='line'>
</span><span class='line'>The program used as the shell is taken from the variable `SHELL'.  If
</span><span class='line'>this variable is not set in your makefile, the program `/bin/sh' is
</span><span class='line'>used as the shell.</span></code></pre></td></tr></table></div></figure>


<p>Make will use <code>sh</code> to execute code in a task, meaning some stuff might not work
as you&rsquo;re probably using some syntax that&rsquo;s specific to bash &mdash; in order to switch
you can simply specify the <code>SHELL</code> variable (in our case
we would want to use <code>SHELL:=/bin/bash</code>).</p>

<p>As seen before, sometimes you will need to use a quirky, custom syntax to get a
regular shell command to work in <code>make</code> &mdash; just like variables need to be escaped
with a <code>$$</code> or <code>${...}</code>, you will need to use <code>shell</code> when using <a href="http://tldp.org/LDP/abs/html/commandsub.html">command substitution</a>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>subshell:
</span><span class='line'>  echo $(shell echo ${USER})</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/tmp ᐅ make subshell
</span><span class='line'>echo alex
</span><span class='line'>alex</span></code></pre></td></tr></table></div></figure>


<p>Don&rsquo;t believe me? Try removing the <code>shell</code> instruction and here&rsquo;s what you&rsquo;re going
to get:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/tmp ᐅ make subshell
</span><span class='line'>echo
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<h2>Conclusion</h2>

<p>There&rsquo;s so much more <code>make</code> can do, and so many more quirky things you might need
to find out to decrease the wps (<em>WTF per second</em>) when working with it :) that
doesn&rsquo;t erase the fact that <code>make</code> is an extremely helpful took that allows us
to automate workflows with ease, without having to setup very complicated pipelines,
by writing tab-separated lines with a bunch of shell commands instead.</p>
</div>



<div class="recent entry-content">
  <hr class="divider-cazzuto">
  <h3>
    In the mood for some more reading?
  </h3>
  <ul>
    
      <li><a href="/mysql-features-i-cant-wait-for-them-to-happen/">MySQL features I can’t wait for them to happen</a> (07 May 2022)</li>
    
      <li><a href="/dell-xps-13-9310-usb-c-port-not-recognizing-external-devices/">Dell XPS 13 9310: USB-C port not recognizing external devices</a> (25 July 2021)</li>
    
      <li><a href="/book-review-working-backwards/">Book review: Working Backwards</a> (24 July 2021)</li>
    
      <li><a href="/fwupd-is-the-best-thing-that-ever-happened-to-linux/">fwupd is the best thing that ever happened to Linux</a> (15 April 2021)</li>
    
      <li><a href="/avoid-battery-draining-on-your-linux-flavored-dell-xps/">Avoid battery draining on your Linux-flavored Dell XPS</a> (31 January 2021)</li>
    
      <li><a href="/combining-two-numbers-into-a-unique-one-pairing-functions/">Combining two numbers into a unique one: pairing functions</a> (05 December 2020)</li>
    
      <li><a href="/running-ci-tests-in-kubernetes-through-github-actions/">Running CI tests in Kubernetes through Github Actions</a> (20 March 2020)</li>
    
  </ul>
    <p>
      ...or <a href="/archives/">check the archives</a>.
    </p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.0/anchor.min.js"></script>
<script type="text/javascript" />
(function () {
  'use strict';

  anchors.options = {
    placement: 'left',
    visible: 'hover',
    icon: '¶'
  };

  anchors.add('h2');
  anchors.add('h3');
  anchors.add('h4');

})();
</script>

			<footer>
				<center>
	Copyleft <!--[if lte IE 8]><span style="filter: FlipH; -ms-filter: "FlipH"; display: inline-block;"><![endif]--><span style="-moz-transform: scaleX(-1); -o-transform: scaleX(-1); -webkit-transform: scaleX(-1); transform: scaleX(-1); display: inline-block;">©</span><!--[if lte IE 8]></span><![endif]--> 2022 — Alessandro Nadalin
	<address>
	</address>
</center>
			</footer>
		</div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-7407627-3', 'auto');
      ga('send', 'pageview');
	</script>
	
	<script type="application/ld+json">
		{
		"@context": "https://schema.org/",
		"@type": "BlogPosting",
		"mainEntityOfPage": {
			"@type": "WebPage",
			"@id": "https://odino.org/makefile-101/"
		},
		"headline": "Makefile 101",
		"description": "A brief introduction to Make and Makefiles, one of Linux's true gems.",
		
		"author": {
			"@type": "Person",
			"name": "Alessandro Nadalin"
		},
		"datePublished": "2018-06-15 09:53:00 +0000"
		}
	</script>
	
	</body>
</html>
<!-- END _layouts/default.html -->
