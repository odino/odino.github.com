<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Alessandro Nadalin]]></title>
  <link href="http://www.odino.org/atom.xml" rel="self"/>
  <link href="http://www.odino.org/"/>
  <updated>2012-07-27T06:59:01+04:00</updated>
  <id>http://www.odino.org/</id>
  <author>
    <name><![CDATA[Alessandro Nadalin]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Logging JavaScript errors]]></title>
    <link href="http://www.odino.org/logging-javascript-errors/"/>
    <updated>2012-07-27T09:00:00+04:00</updated>
    <id>http://www.odino.org/logging-javascript-errors</id>
    <content type="html"><![CDATA[<p>In one of my latest posts I talked about
<a href="http://www.odino.org/using-monolog-for-php-error-reporting-on-new-relic/">using Monolog to remotely log stuff on New Relic</a>:
getting a bit deeper on log management
systems, here&#8217;s how we managed to report
JavaScript errors on our logs.</p>

<!-- more -->


<h2>A note on JavaScript errors</h2>

<p>It may not sound obvious, but errors,
in JavaScript, can be pretty nasty, since
it&#8217;s an - almost completely<sup id='fnref:1'><a href='#fn:1' rel='footnote'>1</a></sup> - client-dependent
technology that can react differently to
your code based on the client&#8217;s platform.</p>

<p>Cross-browser testing may not always be
performed <em>that</em> accurately, so you should
definitely start tracking JS error that may
happen of different clients.</p>

<h2>The concept</h2>

<p>This is <strong>totally not an idea of mine</strong>: it
comes from a pretty smart <a href="http://devblog.pipelinedeals.com/pipelinedeals-dev-blog/2012/2/12/javascript-error-reporting-for-fun-and-profit-1.html">blog post which illustrates the main concept</a>:
when a JS error is encountered, you trigger an HTTP request
to a URL that collect the data transmitted
within that request and logs it with
server-side code.</p>

<figure class='code'><figcaption><span>How to trigger JS error reporting</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">MaximumErrorCount</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">errorMsg</span><span class="p">,</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">lineNumber</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nb">window</span><span class="p">.</span><span class="nx">errorCount</span> <span class="o">||</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">errorCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">errorCount</span> <span class="o">&lt;=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">MaximumErrorCount</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">jQuery</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/jsError/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">errorMessage</span><span class="o">:</span>   <span class="nx">errorMsg</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">file</span><span class="o">:</span>           <span class="nx">file</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">url</span><span class="o">:</span>           <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">lineNumber</span><span class="o">:</span>     <span class="nx">lineNumber</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">ua</span><span class="o">:</span>             <span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, at the end, you only need to add some basic
server-side code to handle the reported data:</p>

<figure class='code'><figcaption><span>How to handle reported informations</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">ErrorController</span> <span class="k">extends</span> <span class="nx">Controller</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">const</span> <span class="no">MESSAGE_LOG_JAVASCRIPT</span> <span class="o">=</span> <span class="s1">&#39;A javascript error &quot;%s&quot; has been encountered at the URL %s on file %s:%s by an agent of type %s&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="k">function</span> <span class="nf">logJavaScriptAction</span><span class="p">(</span><span class="nv">$postData</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="nv">$logMessage</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span>
</span><span class='line'>          <span class="nx">self</span><span class="o">::</span><span class="na">MESSAGE_LOG_JAVASCRIPT</span><span class="p">,</span>
</span><span class='line'>          <span class="nv">$postData</span><span class="p">[</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">],</span>
</span><span class='line'>          <span class="nv">$postData</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">],</span>
</span><span class='line'>          <span class="nv">$postData</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">],</span>
</span><span class='line'>          <span class="nv">$postData</span><span class="p">[</span><span class="s1">&#39;lineNumber&#39;</span><span class="p">],</span>
</span><span class='line'>          <span class="nv">$postData</span><span class="p">[</span><span class="s1">&#39;ua&#39;</span><span class="p">]</span>
</span><span class='line'>      <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getLogger</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addError</span><span class="p">(</span><span class="nv">$logMessage</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>You may want to write some additional
code to only report errors that you should
really fix: based on the user-agent, for
example, you can ignore errors triggered
on <code>MSIE 7.0</code>/<code>MSIE 6.0</code>.</p>

<h2>All in all&#8230;</h2>

<p>This has been a great solution for us,
since we could easily keep track of JS
code which was causing errors due to:</p>

<ul>
<li>lack of compatibility between developers&#8217;/users&#8217;
platforms</li>
<li>typos and small errors</li>
<li>tricky situations in which our code depends on
3rd party scripts that would break our functionality
whenever they are not available/cause an error upon
execution</li>
</ul>


<div class="footnotes">
<span>
Notes
</span>
    <ol>
        <li id='fn:1'>NodeJS <a href='#fnref:1' rev='footnote'>↩</a></li>
    </ol>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using Monolog for PHP error reporting on New Relic]]></title>
    <link href="http://www.odino.org/using-monolog-for-php-error-reporting-on-new-relic/"/>
    <updated>2012-07-27T08:00:00+04:00</updated>
    <id>http://www.odino.org/using-monolog-for-php-error-reporting-on-new-relic</id>
    <content type="html"><![CDATA[<p>I <strong>do</strong> really like <a href="http://newrelic.com/">New Relic</a>, a real-time
error reporting solution available for many
platforms, so a few days ago I decided to
integrate it with <a href="https://github.com/Seldaek/monolog/">Monolog</a>, the other
main logging tool that we use here at
Rocket.</p>

<!-- more -->


<p>The idea behind it is very simple: since
New Relic is not always available on
development platforms, you first verify
that the PHP extension is loaded, then,
if it is, log a report on New Relic:
if the extension is not available, another
logging handler will act as a fallback.</p>

<p>To reach our goal we will simply need the
New Relic PHP extension, Monolog and the
Symfony2 <a href="http://symfony.com/doc/current/book/service_container.html">dependency injection container</a>.</p>

<h2>Catching the error and reporting it</h2>

<p>Let&#8217;s start with a real world example, you
have a controller action that receives some
<code>POST</code> data and throws an exception whenever
the input data is missing some values<sup id='fnref:1'><a href='#fn:1' rel='footnote'>1</a></sup>.</p>

<figure class='code'><figcaption><span>A simple action</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">Application\Webservice</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Application\MVC\Controller</span> <span class="k">as</span> <span class="nx">BaseController</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Application\Webservice\Exception</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Controller</span> <span class="k">extends</span> <span class="nx">BaseController</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">function</span> <span class="nf">updateDatabaseData</span><span class="p">(</span><span class="k">array</span> <span class="nv">$data</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>          <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validateData</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>          <span class="c1">// ...</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">container</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;logger.new-relic&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">(),</span> <span class="nv">$data</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, at this point, we just need to define the <code>logger.new-relic</code>
service in the DIC configuration file:</p>

<figure class='code'><figcaption><span>The DIC configuration file</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">logger.new-relic</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="s">&quot;Monolog\\Logger&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">arguments</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="s">&quot;new-relic&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">calls</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="p-Indicator">[</span> <span class="nv">pushHandler</span><span class="p-Indicator">,</span> <span class="p-Indicator">[</span><span class="err">@</span><span class="nv">log.handler.new-relic</span><span class="p-Indicator">]</span> <span class="p-Indicator">]</span>
</span><span class='line'>  <span class="l-Scalar-Plain">log.handler.new-relic</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span>  <span class="s">&quot;\\Application\\Log\\Handler\\NewRelic&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">calls</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="p-Indicator">[</span> <span class="nv">setFallbackHandler</span><span class="p-Indicator">,</span> <span class="p-Indicator">[</span><span class="err">@</span><span class="nv">log.handler.standard</span><span class="p-Indicator">]</span> <span class="p-Indicator">]</span>
</span><span class='line'>  <span class="l-Scalar-Plain">log.handler.standard</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span>  <span class="s">&quot;Monolog\\Handler\\StreamHandler&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">arguments</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">stream</span><span class="p-Indicator">:</span> <span class="s">&quot;/tmp/error-log.txt&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you see we define a Monolog logger designed
specifically for New Relic (<code>logger.new-relic</code>)
and an handler that will try to log everything
on the remote NR server: this handler also has a
fallback handler, if the New Relic PHP extension is
not available, which is configurable directly
within the YAML file (<code>log.handler.error</code>).</p>

<h2>The log handler</h2>

<p>The New Relic handler is <strong>really</strong>
straightforward:</p>

<figure class='code'><figcaption><span>The New Relic log handler</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Class used to log on New Relic.</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">Application\Log\Handler</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Monolog\Handler\AbstractProcessingHandler</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Monolog\Handler</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">NewRelic</span> <span class="k">extends</span> <span class="nx">AbstractProcessingHandler</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$fallbackHandler</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Logs a $record on New Relic, providing additional parameters from the</span>
</span><span class='line'><span class="sd">     * record&#39;s context.</span>
</span><span class='line'><span class="sd">     * If the New Relic extension is not available and a fallback handler is</span>
</span><span class='line'><span class="sd">     * provided, it will simply log the error with a fallback.</span>
</span><span class='line'><span class="sd">     * </span>
</span><span class='line'><span class="sd">     * @param array $record </span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="k">function</span> <span class="nf">write</span><span class="p">(</span><span class="k">array</span> <span class="nv">$record</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nb">extension_loaded</span><span class="p">(</span><span class="s1">&#39;newrelic&#39;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">newrelic_notice_error</span><span class="p">(</span><span class="nv">$record</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$record</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$parameter</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">newrelic_add_custom_parameter</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$parameter</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fallbackHandler</span> <span class="nx">instanceOf</span> <span class="nx">AbstractProcessingHandler</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fallbackHandler</span><span class="o">-&gt;</span><span class="na">write</span><span class="p">(</span><span class="nv">$record</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Sets the fallback handler to be used to log informations if the New Relic</span>
</span><span class='line'><span class="sd">     * extension is not available.</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param Monolog\Handler\AbstractProcessingHandler $handler </span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">setFallbackHandler</span><span class="p">(</span><span class="nx">AbstractProcessingHandler</span> <span class="nv">$handler</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fallbackHandler</span> <span class="o">=</span> <span class="nv">$handler</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, the code is pretty simple: we implement the <code>write</code> method
of <code>AbstractProcessingHandler</code> in our <code>New Relic</code> class,
using New Relic&#8217;s low level functions to notice the
error and add some more informations about the
context surrounding the exception: the fallback
handler will take stage only if the New Relic
extension isn&#8217;t loaded.</p>

<h2>Log systems and analysis</h2>

<p>Simple but pretty useful: if you use either
New Relic or Monolog I strongly recommend you
to integrate into your log management system
the missing tool since:</p>

<ul>
<li>New Relic serves as a nice reporting tool,
giving you an overview of the amount of
errors logged over some time, letting you
define tresholds for error reporting and
grouping errors to measure the impact a code
change can have on your applications<sup id='fnref:2'><a href='#fn:2' rel='footnote'>2</a></sup></li>
<li>Monolog gives you a great abstraction and
log handlers, which can very easily ease
your job in taking the right action for
different types of errors<sup id='fnref:3'><a href='#fn:3' rel='footnote'>3</a></sup>
(as you saw, with the DIC it&#8217;s pure joy to
instantiate and use different handlers based
on a configuration file)</li>
</ul>


<p>At Rocket Turkey &amp; MENA we really care about logs:
being a product-based company, <strong>a bug in our
system is a bug on our core business</strong>, so we need
to easily be able to spot problems.</p>

<p>So far, using Monolog and New Relic as both standalone and combined
products has been a very good choice, since with
New Relic with have a pretty overview about
error reporting, while Monolog gives us the
ability to easily debug problems in our
integrations, since solving problems with all
the data we track with it it&#8217;s really easier,
and if we need to change logs&#8217; format or add new data
to the logs because we notice that it would speed
up troubleshooting and log analysis, making
the change is relatively easy, since it&#8217;s a
really well OOP-written library.</p>

<div class="footnotes">
<span>
Notes
</span>
    <ol>
        <li id='fn:1'>Bare in mind that I will be very brief in my examples, so you won&#8217;t learn how to bootstrap the DIC here, for example <a href='#fnref:1' rev='footnote'>↩</a></li><li id='fn:2'>I say applications since, as you may know, in New Relic you can handle multiple machines to be registered as different applications (like frontend/backend/mail server/cron slave/gateway) <a href='#fnref:2' rev='footnote'>↩</a></li><li id='fn:3'>In fact,whenever an email is not delivered by your email sever, it&#8217;s not a problem, but when you start seeing that the amount of mails that are not delivered are too much, you may consider to use a critical handler, specifically designed to send an SMS/email to some contacts <a href='#fnref:3' rev='footnote'>↩</a></li>
    </ol>
</div>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Bootstrap of a Travis-CI test-machine]]></title>
    <link href="http://www.odino.org/bootstrap-of-a-travis-ci-test-machine/"/>
    <updated>2012-07-27T07:00:00+04:00</updated>
    <id>http://www.odino.org/bootstrap-of-a-travis-ci-test-machine</id>
    <content type="html"><![CDATA[<p><a href="http://travis-ci.org/">Travis-CI</a> is an awesome open source service which
makes continuos integration really easy in the context
of <em>github-hosted</em> projects.</p>

<!-- more -->


<p>Developing Orient, I found out about Travis when one of
the 3 active guys actively collaborating to the project,
<a href="https://github.com/nrk">Daniele</a> created his own fork of the library to create
the CI environment on Travis.</p>

<h2>More than testing</h2>

<p>Travis doesn&#8217;t only provide a machine in which you can
continuosly running tests, it gives you a <strong>free</strong> VM
which you can <strong>freely</strong> manage in the context of testing
an application: although they don&#8217;t actually give you a &#8220;real&#8221; VM, they provide
you an <strong>temporary VM</strong> which gets bootstrapped following
your indications and executes the tasks that <strong>you</strong>
indicate: in that sense, Travis gives you VMs
<em>on-demand</em>.</p>

<p>So think about it: it&#8217;s not only about testing, it&#8217;s about
having an environment ready to do anything you want for
your own project, like running reports.</p>

<h2>A real world example</h2>

<p>For <a href="http://github.com/congow/Orient">Orient</a>, Daniele managed to setup a quite clever
bootstrap script.</p>

<p>We have a quite comprehensive test-suite which you can
execute with the single <code>phpunit</code> command, from the root
of the library, but it just executes tests which dont
directly talk to OrientDB.</p>

<p>To execute the full test-suite, including integration
tests, you just need to pass the test directory to the
CLI:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">phpunit test/</span>
</span></code></pre></td></tr></table></div></figure>


<p>but you&#8217;ll need a working instance of OrientDB, with
predefined admin credentials (<code>admin</code>/<code>admin</code>) listening
on port <code>:2480</code>.</p>

<p>So our challenge was to use Travis and being able to trigger
the integration tests.</p>

<p>In the <code>.travis.yml</code> configuration file, we have:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">language: php</span>
</span><span class='line'><span class="x">php:</span>
</span><span class='line'><span class="x">  - 5.3</span>
</span><span class='line'><span class="x">  - 5.4</span>
</span><span class='line'><span class="x">before_script:</span>
</span><span class='line'><span class="x">  - sh -c ./bin/initialize-ci.sh 1.0rc6</span>
</span><span class='line'><span class="x">script: phpunit test/</span>
</span><span class='line'><span class="x">notifications:</span>
</span><span class='line'><span class="x">  email:</span>
</span><span class='line'><span class="x">    - ...@gmail.com</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, as you see, we have a bash script which
takes care of everything:</p>

<figure class='code'><figcaption><span>./bin/initialize-ci.sh 1.0rc6</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/sh</span>
</span><span class='line'>
</span><span class='line'><span class="nv">PARENT_DIR</span><span class="o">=</span><span class="k">$(</span>dirname <span class="k">$(</span><span class="nb">cd</span> <span class="s2">&quot;$(dirname &quot;</span><span class="nv">$0</span><span class="s2">&quot;)&quot;</span>; <span class="nb">pwd</span><span class="k">))</span>
</span><span class='line'><span class="nv">CI_DIR</span><span class="o">=</span><span class="s2">&quot;$PARENT_DIR/ci-stuff/environment&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">ODB_VERSION</span><span class="o">=</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="s2">&quot;1.0rc6&quot;</span><span class="k">}</span>
</span><span class='line'><span class="nv">ODB_PACKAGE</span><span class="o">=</span><span class="s2">&quot;orientdb-${ODB_VERSION}&quot;</span>
</span><span class='line'><span class="nv">ODB_DIR</span><span class="o">=</span><span class="s2">&quot;${CI_DIR}/${ODB_PACKAGE}&quot;</span>
</span><span class='line'><span class="nv">ODB_LAUNCHER</span><span class="o">=</span><span class="s2">&quot;${ODB_DIR}/bin/server.sh&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;=== Initializing CI environment ===&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">cd</span> <span class="s2">&quot;$PARENT_DIR&quot;</span>
</span><span class='line'>
</span><span class='line'>. <span class="s2">&quot;$PARENT_DIR/bin/odb-shared.sh&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> ! -d <span class="s2">&quot;$CI_DIR&quot;</span> <span class="o">]</span>; <span class="k">then</span>
</span><span class='line'>  <span class="c"># Fetch the stuff needed to run the CI session.</span>
</span><span class='line'>  git clone --quiet git://gist.github.com/1370152.git <span class="nv">$CI_DIR</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># Download and extract OrientDB</span>
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;--- Downloading OrientDB v${ODB_VERSION} ---&quot;</span>
</span><span class='line'>  odb_download <span class="s2">&quot;http://orient.googlecode.com/files/${ODB_PACKAGE}.zip&quot;</span> <span class="nv">$CI_DIR</span>
</span><span class='line'>  unzip -q <span class="s2">&quot;${CI_DIR}/${ODB_PACKAGE}.zip&quot;</span> -d <span class="nv">$ODB_DIR</span> <span class="o">&amp;&amp;</span> chmod +x <span class="nv">$ODB_LAUNCHER</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># Copy the configuration file and the demo database</span>
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;--- Setting up OrientDB ---&quot;</span>
</span><span class='line'>  tar xf <span class="nv">$CI_DIR</span>/databases.tar.gz -C <span class="s2">&quot;${ODB_DIR}/&quot;</span>
</span><span class='line'>  cp <span class="nv">$PARENT_DIR</span>/ci-stuff/orientdb-server-config.xml <span class="s2">&quot;${ODB_DIR}/config/&quot;</span>
</span><span class='line'>  cp <span class="nv">$PARENT_DIR</span>/ci-stuff/orientdb-server-log.properties <span class="s2">&quot;${ODB_DIR}/config/&quot;</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="k">  </span><span class="nb">echo</span> <span class="s2">&quot;!!! Directory $CI_DIR exists, skipping downloads !!!&quot;</span>
</span><span class='line'><span class="k">fi</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Start OrientDB in background.</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;--- Starting an instance of OrientDB ---&quot;</span>
</span><span class='line'>sh -c <span class="nv">$ODB_LAUNCHER</span> &lt;/dev/null &amp;&gt;/dev/null &amp;
</span><span class='line'>
</span><span class='line'><span class="c"># Wait a bit for OrientDB to finish the initialization phase.</span>
</span><span class='line'>sleep 5
</span><span class='line'><span class="nb">printf</span> <span class="s2">&quot;\n=== The CI environment has been initialized ===\n&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>I think the script speaks for itsef: we directly download
OrientDB from the official website, de-compress it, configure
OrientDB with our standard configuration file and launch the
ODB server, outputting in <code>/dev/null</code>.</p>

<p>Now, all of this happens everytime someone commits to the <code>master</code>
on Github: pretty easy, simple but so powerful.</p>

<p>I really recommend you to start having a look at Travi-CI
and how you can benefit from a CI server, fully configurable,
for free, for the sake of your own code.</p>

<p>One last note: yes, all of this comes for free, but if you use
Travis you should really consider making a donation to
show the guys behind the project <a href="http://love.travis-ci.org/">your love</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Where is Agile?]]></title>
    <link href="http://www.odino.org/what-is-agile/"/>
    <updated>2012-07-23T20:20:00+04:00</updated>
    <id>http://www.odino.org/what-is-agile</id>
    <content type="html"><![CDATA[<p>I&#8217;m a pragmatic programmer, not a pragmatic agilist.</p>

<p>If I had to be a pragmatic agilist during my career,
I&#8217;d have been fired several times, and that&#8217;s why.</p>

<!-- more -->


<h2>The Agile rape</h2>

<p><img class="right" src="http://www.odino.org/images/televangelist.jpg"></p>

<p>We hear the word <em>Agile</em> everywhere, thanks to the fact that
this is a concept 10 years old, brought to the public by some
of the <strong>greatest minds in computer engineering</strong>, who could also
describe <a href="http://www.amazon.com/Patterns-Enterprise-Application-Architecture-Martin/dp/0321127420">interesting things</a>
other than a cool way to have more fun and be more productive at work.</p>

<p>Let&#8217;s face it: the word &#8221;<em>Agile</em>&#8221;&#8221; has been raped over the past
5 years.
This is not because it became mainstream and everyone
wanted to adopt it, it&#8217;s because once it was about to
become mainstream a lot of people heard of it and
wanted to integrate <strong>their own</strong> vision of agile
development into their IT infrastructures.</p>

<p>You read it: <strong>their</strong> own vision.</p>

<p>Take a look at the <a href="http://en.wikipedia.org/wiki/Lean_software_development">lean software development</a>: we have
the <a href="http://www.amazon.com/Mary-Poppendieck/e/B001IGNU3O/">Poppendieck saga</a>
and not much more; sure, there are a lot of books and a
lot of opinions about LSD across IT professionals,
nonetheless everyone takes inspiration from the infamous
<em>weds</em>, not from what they heard about what they wrote.</p>

<p>Fact, this is the reason why LSD is still a pure oasis
in IT<sup id='fnref:1'><a href='#fn:1' rel='footnote'>1</a></sup>.</p>

<h2>SCRUM</h2>

<p>Sure, one of the things I&#8217;d point my finger against is SCRUM.</p>

<p>This lightweight agile methodolgy is probably on everyone&#8217;s
mouth since 3 years, since lot of people adopted it and
it seem to work: nonetheless, SCRUM is failing and will continue failing
in preserving and communicating the legacy of the agile
principles, values and patterns.</p>

<p><img class="right" src="http://www.odino.org/images/rugby-scrum.jpg"></p>

<p>The problem with SCRUM is not SCRUM itself, because I
think it <em>may</em> work in some contexts, but to the way
people interpret it and implement it in their own
processes:</p>

<ul>
<li>the focus is shifted from the IT team and the transparency
betweem the <strong>whole team</strong> to the <em>product owner</em>, which acts
as a benevolent dictator between the team and the customer</li>
<li>whenever you add a layer between programmers and the
customer, you introduce an overhead, which means a less efficient
communication</li>
<li>SCRUM masters often fail to facilitate, since they become
a bottleneck in the process: if a problem depends to the SM,
N people in the development team have to rely and wait for him,
while, if the team act as a standalone being, each part of it
can theoretically deal with problems applying a FIFO
principle (<em>first in, first out</em>, sorting problems by priority
and business value rather than age)</li>
<li>1 out of 2 <strong>certified SCRUM masters</strong> that I meet don&#8217;t
even know how to finish <em>&#8220;Individuals and interactions&#8230;&#8221;</em>
which I find first offensive second really frustrating</li>
</ul>


<p>Yes, the last one is a merely pure personal observation:
still, there&#8217;s no doubt about the certification itself,
which I find pretty overestimated.</p>

<p>[Formally] <strong>Certifying processes that don&#8217;t have formal
approaches</strong> is purely counter-intuitive: sorry, agile
processes are not formal<sup id='fnref:2'><a href='#fn:2' rel='footnote'>2</a></sup>.</p>

<p>All in all the history of SCRUM and its adopters teaches
us that a few big corporations are willing to make a step
and try to embrace agile development, with the wrong approach:
if you will to adopt something that - oh, boy! - has a
manifesto you should, in first place, try not to betray
its values, <strong>transparency at first place</strong>.</p>

<h2>We are different</h2>

<p>The reality is that I never heard stories from the trenches of
an agile organization: ok, I read them, ok, I heard
something, but I never spoke with someone who illustrated
me a 100% adoption of one agile methodology,
no matter if SCRUM, crystal or XP<sup id='fnref:3'><a href='#fn:3' rel='footnote'>3</a></sup>.</p>

<p>I still think that embracing agile is the winning
option, (almost) no matter when and where:
share with me your stories, I&#8217;d be glad to
give them some space here.</p>

<p>Still, agile&#8217;s biggest problems are both
management and programmers: the management always
has a skeptical eye on new methodologies that
make their teams slower<sup id='fnref:4'><a href='#fn:4' rel='footnote'>4</a></sup> and
programmers often think that they should interpret
their own view of agile development.</p>

<p>Just a mention: I worked several months for a firm
who was selling itself as &#8220;agile&#8221; or - at least -
&#8220;agile-prone&#8221;, while no one ever did a retrospective
<strong>in months</strong>.</p>

<p>I spoke with PMs, I spoke with the CTO, I spoke with
the programmers: everyone had good intentions but no
one was <strong>eager to be the change</strong>, not to <strong>just talk</strong>.</p>

<p>Back then, it was really frustrating: so no surprise I
parted ways with that organization while account
managers are still there, working every day until 9pm
because &#8221;<em>in this industry it works like this</em>&#8221;.</p>

<p>&#8220;<a href="http://www.agiledevelopment.it/2012/01/we-are-different/">We are different</a>&#8221;,
they said.</p>

<h2>An agile and slower IT would just be a pain for our business</h2>

<p>IT is a bottleneck, <strong>get over it</strong>.</p>

<p>Still, most organizations think that the problem between their
ideas and their success is IT, since it tends to slow down and
raise doubts about estimates, delivery times and implementations.</p>

<p>Now, put things this way: you have a great idea, you
know it&#8217;s gonna work.</p>

<p>Sadly, having an idea and implementing it are different things:
in a case, you think it and it becomes real, in the other
you need to work hard and in a very qualitative way not to
limit and ruin the motivation behind your work - guess
if IT fits in the first or the second case.</p>

<p>Still, <strong>IT is a bottleneck</strong>.</p>

<p>Be fine with it, that&#8217;s why technicians tend to limit/screw
your ideas: they try to bring you back to reality and suggest
the most credibile solutions to your problems.
They have to be the bottleneck between a management&#8217;s
childish dreams and reality.</p>

<p><img class="right" src="http://www.odino.org/images/bottleneck.jpg"></p>

<p>Still, <strong>agile is a bottleneck</strong>.</p>

<p>Be fine with it, that&#8217;s why agilists tend to enpower
collaboration: they try to find the best mid-term
solution for your problem, to help your business not
facing IT bottlenecks in <em>put-some-number-here</em> months.
They have to be the bottleneck between a management&#8217;s
lack of knowledge and technology.</p>

<p>That&#8217;s why the management should listen to its IT
department and get some genuine advices about their
digital strategy and the upcoming issues that technology
could reserve them ( read &#8220;it&#8217;s stupid to spend 600k on
facebook ads for a mini-site if you dont have the right
servers to handle the groundbreaking traffic which
will come from ads themselves&#8221; ).</p>

<p>I once worked in a company where the CEO thought we could
do whatever technologic project people would have
asked for: the CTO - pretty seasoned - was battling
everyday to get this guy understand that a salesman
cannot sell projects he doesn&#8217;t know, at all - and yes,
that salesman was the CEO<sup id='fnref:5'><a href='#fn:5' rel='footnote'>5</a></sup>.</p>

<p>It&#8217;s funny how management tend to prove itself as the
dumbest department ever: you hire <em>some-area</em> professionals,
you pay them lot of money, you hear what they say,
you eventually ignore them<sup id='fnref:6'><a href='#fn:6' rel='footnote'>6</a></sup>.</p>

<p>Results?</p>

<ul>
<li>you could have saved a lot just hiring monkeys</li>
<li>you will make people working on stuff against their will</li>
</ul>


<p>Still, <strong>your problem with IT is you</strong>, not IT itself.</p>

<p>Now ask IT guys if they would like to work the agile way: 80%
of them will just tell you &#8220;of course&#8221; (at least in europe).
Now ask IT guys how many of them work in a company which
truly promotes agile development, following <strong>both
processes and values</strong>: 15% of them will get back to you
with a positive answer.</p>

<p>A failure, because it means that - still - IT
departments don&#8217;t have the decisional power to
make their job better, easier and safer from
a business perspective<sup id='fnref:7'><a href='#fn:7' rel='footnote'>7</a></sup>.</p>

<p><img class="left" src="http://www.odino.org/images/celtics.jpeg"></p>

<h2>Agile is not a reality</h2>

<p>Today I hear too many people talking about agile<sup id='fnref:8'><a href='#fn:8' rel='footnote'>8</a></sup>
while too few organizations succesfully implement it
in their own processes: simply, <strong>agile is mainstream but not a
reality</strong>.</p>

<p>You need the right people to truly integrate and implement
an agile methodology, this is a simple fact, and &#8221;<em>the
right people</em>&#8221; doesn&#8217;t always mean experts, but people
who truly believe in agile values.</p>

<p><a href="http://en.wikipedia.org/wiki/Phil_Jackson">Phil Jackson</a>
won 11 NBA titles while coaching Chicago (11)
and the Los Angeles Lakers (5), always using the <a href="http://en.wikipedia.org/wiki/Triangle_offense">triangle offense</a>.</p>

<p>Look at his teams:</p>

<ul>
<li>Scottie Pippen, Michael Jordan and Dennis Rodman in his runs with the Bulls</li>
<li>Kobe Bryant, Shaquille O&#8217;Neal and Derek Fisher with his first Lakers</li>
</ul>


<p><img class="right" src="http://www.odino.org/images/red-auerbach.jpg"></p>

<p>Simply, he was preaching the triangle offense and had the
right men at the right time.</p>

<p><a href="http://en.wikipedia.org/wiki/Red_Auerbach">Red Auerbach</a>,
the Boston Celtics legend, built several
( as a coach first as well as GM later ) teams
devoted to team-playing, respect and pride.
Counting up to 10 NBA titles.</p>

<p>He had Larry &#8220;The Legend&#8221; Bird, Kevin McHale, Robert
Parish, Glenn &#8220;Doc&#8221; Rivers, Bill Russel&#8230; I should stop:
he simply - again - had the right people.</p>

<p><strong>You</strong> say it&#8217;s a coincidence: less words, more
people.</p>

<div class="footnotes">
<span>
Notes
</span>
    <ol>
        <li id='fn:1'>Don&#8217;t be so enthusiast: in 2 years what happened to the agile software development will happen to LSD <a href='#fnref:1' rev='footnote'>↩</a></li><li id='fn:2'>Quoting Ron Jeffries: http://www.sviluppoagile.it/sfuggente-e-di-qualita (italian article with english quotes) <a href='#fnref:2' rev='footnote'>↩</a></li><li id='fn:3'>Ok, maybe - in Italy - Ideato is the only example I can mention, but they are too small to count as a truly succesfull story <a href='#fnref:3' rev='footnote'>↩</a></li><li id='fn:4'>Following agile practices makes your team slower: that&#8217;s a fact. For their first months programmers need to learn a new way to manage their job and handle collaboration among team members. Not to mention that when the team is experienced, kickstarting an agile project will always be slower, since in your first steps ( = iterations ) you tend to be more pragmatic and deliver with the highest quality, while cowboy coders start like the new John Wayne and end up screwing everything they can. <a href='#fnref:4' rev='footnote'>↩</a></li><li id='fn:5'>Now, that company is about to implode, guess why <a href='#fnref:5' rev='footnote'>↩</a></li><li id='fn:6'>It&#8217;s funny how I was surprised - joining Rocket - when PMs and MDs were really about to follow your advices :) some of my previous experiences were really too far from this <a href='#fnref:6' rev='footnote'>↩</a></li><li id='fn:7'>Keep in mind that leveraging the technical quality of IT products ( like agile does ) means delivering software without a vendor&#8217;s lock-in: as a result, agilists trust their job and try to deliver the best artifact they can, since they would be replaceable at any time of the process &#8211; see, everything for the customer&#8217;s advantage <a href='#fnref:7' rev='footnote'>↩</a></li><li id='fn:8'>Myself included <a href='#fnref:8' rev='footnote'>↩</a></li>
    </ol>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Speaking at IPC 2012]]></title>
    <link href="http://www.odino.org/speaking-at-ipc-2012/"/>
    <updated>2012-07-23T19:34:00+04:00</updated>
    <id>http://www.odino.org/speaking-at-ipc-2012</id>
    <content type="html"><![CDATA[<p>Now it&#8217;s official: in October I will be
in Mainz for <a href="http://phpconference.com/">IPC 2012</a>.</p>

<!-- more -->


<p>No doubts anymore: I will be present - for my first time -
at the most prestigious<sup id='fnref:1'><a href='#fn:1' rel='footnote'>1</a></sup> european PHP conference,
a travel more than 6 thousand kilometers long:</p>

<iframe width="750" height="600" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://maps.google.com/maps?f=q&amp;source=s_q&amp;hl=en&amp;geocode=FWObgQEd3exLAylFxtlqSUNfPjFiUSmEUG7mvQ%3BFZ7U-gId1dd9ACl5E98zLpG9RzGgG9sQ1dQiBA&amp;q=from+Dubai+to+Mainz&amp;aq=&amp;sll=32.93158,33.8919&amp;sspn=21.939821,46.538086&amp;ie=UTF8&amp;t=m&amp;saddr=Dubai&amp;daddr=Mainz&amp;ll=37.0008,31.761065&amp;spn=26.13436,47.12413&amp;output=embed"></iframe>


<p>I will bring with me a new talk<sup id='fnref:2'><a href='#fn:2' rel='footnote'>2</a></sup>, which
mainly deals with protocols:</p>

<ul>
<li>history of <code>HTTP</code></li>
<li>hiddent features of <code>HTTP/1.1</code></li>
<li>what should we expect from <code>HTTP/2.0</code></li>
<li>how <code>SPDY</code> is revolutionizing web protocols</li>
</ul>


<p>If you&#8217;ll be there, dont hesitate and drop me a line
at <em>alessandro.nadalin@gmail.com</em>, it will be a good
opportunity to have a chat about PHP and the
<a href="http://www.odino.org/moving-to-dubai/">Middle East</a>.</p>

<div class="footnotes">
<span>
Notes
</span>
    <ol>
        <li id='fn:1'>Not a lot of doubts about this, which doesnt automatically make it the best european PHP conference: my memories of the PHP Benelux Conference 2011 are still alive <a href='#fnref:1' rev='footnote'>↩</a></li><li id='fn:2'>&#8220;HTTP colon slash slash: end of an era?&#8221; <a href='#fnref:2' rev='footnote'>↩</a></li>
    </ol>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Going beyond HTTP at IPC in October]]></title>
    <link href="http://www.odino.org/going-beyond-http-at-ipc-in-october/"/>
    <updated>2012-07-02T13:31:00+04:00</updated>
    <id>http://www.odino.org/going-beyond-http-at-ipc-in-october</id>
    <content type="html"><![CDATA[<p>Just a quick one: seems that in October I&#8217;ll need to travel
all my way back to Europe to speak at the
<a href="http://phpconference.com/">international PHP Conference</a> 2012
in its winter edition.</p>

<!-- more -->


<p>Subject? Oh, something that I <em>really</em> love:</p>

<blockquote><p>For years we&#8217;ve been used to the HTTP protocol, one of the reasons behind the web&#8217;s success, a protocol able to scale up to bilion of requests and beyond.<br/>But there&#8217;s more we can achieve, leveraging HTTP/1.1 hidden feature, taking a look at HTTP/2.0 and SPDY, the Google-proposed new protocol which is already making web faster.</p><p>Back to the basics: what enpowers and will enpower the web?</p></blockquote>


<p>Still to be confirmed - flights, leave days, date - but I should be able
to make it for the first time among the germans.</p>

<p>Hope to see you there!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Use the Strategy to avoid the Switch-Case antipattern]]></title>
    <link href="http://www.odino.org/use-the-strategy-to-avoid-the-switch-case-antipattern/"/>
    <updated>2012-05-14T00:28:00+04:00</updated>
    <id>http://www.odino.org/use-the-strategy-to-avoid-the-switch-case-antipattern</id>
    <content type="html"><![CDATA[<p>In PHP we have tons of bad constructs/functions that don&#8217;t actually
help newcomers on writing good code: the <code>SWITCH/CASE</code> statement is one
of those that I hate the most, although very few developers rely on
it.</p>

<!-- more -->


<p>The statement is pretty straightfoward</p>

<figure class='code'><figcaption><span>Simple SWITCH/CASE statement</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Logger</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">function</span> <span class="nf">logMessage</span><span class="p">(</span><span class="nv">$message</span> <span class="o">=</span> <span class="s2">&quot;CRITICAL::The system encountered a problem&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="nv">$parts</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;::&#39;</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>
</span><span class='line'>      <span class="nv">$level</span> <span class="o">=</span> <span class="nv">$parts</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">switch</span> <span class="p">(</span><span class="nv">$level</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="s1">&#39;notice&#39;</span><span class="o">:</span>
</span><span class='line'>              <span class="o">...</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="k">case</span> <span class="s1">&#39;critical&#39;</span><span class="o">:</span>
</span><span class='line'>              <span class="o">...</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="k">case</span> <span class="s1">&#39;catastrophe&#39;</span><span class="o">:</span>
</span><span class='line'>              <span class="o">...</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>and is intended to make multiple IFs more readable.</p>

<p>It may seem useful, but at first you should recognize that <strong>multiple
IFs are already a bad smell</strong>, so, from the beginning there is something
with a code trying to make them look nicer.</p>

<p>The <a href="http://en.wikipedia.org/wiki/Strategy_pattern">Strategy pattern</a>,
one of my favourites, is a simple but powerful way to avoid writing
procedural code that relies on IFs.</p>

<p>The main concept is that you should contextualize the application&#8217;s
workflow at runtime, deciding which steps (methods) to run based on
data which is external to the method itself.</p>

<figure class='code'><figcaption><span>silly implementation of Strategy</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Logger</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">function</span> <span class="nf">logMessage</span><span class="p">(</span><span class="nv">$message</span> <span class="o">=</span> <span class="s2">&quot;CRITICAL::The system encountered a problem&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="nv">$parts</span>  <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;::&#39;</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>
</span><span class='line'>      <span class="nv">$level</span>  <span class="o">=</span> <span class="nv">$parts</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>      <span class="nv">$method</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;log%sMessage&#39;</span><span class="p">,</span> <span class="nb">ucfirst</span><span class="p">(</span><span class="nv">$level</span><span class="p">));</span>
</span><span class='line'>      <span class="nv">$output</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nv">$method</span><span class="p">(</span><span class="nv">$parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this way we are able to isolate and keep clean the implementations
of the methods, thus the logic behind the application.</p>

<p>This means that we only need to implement submethods:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">logNoticeMessage</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">logCriticalMessage</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">logCatastropheMessage</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>If this doesn&#8217;t seem important to you, consider this scenario:
you are shipping a library with the <code>SWITCH/CASE</code> in the first example;
what would happen if another developer using that library would only
like to edit the logic when a <code>catastrophe</code> message is received?</p>

<p>Yes, he would need to override the entire <code>logMessage</code> method,
<strong>loosing the possibility to benefit of future software updates</strong>
for that specific method.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Back in track with OrientDB]]></title>
    <link href="http://www.odino.org/back-in-track-with-orientdb/"/>
    <updated>2012-04-20T15:26:00+04:00</updated>
    <id>http://www.odino.org/back-in-track-with-orientdb</id>
    <content type="html"><![CDATA[<p>It&#8217;s been a while since I don&#8217;t release any update about
Orient, the PHP data mapper for OrientDB: we recently got
back on track and I have a few interesting news.</p>

<!-- more -->


<p>I just moved to Dubai, as you may know, so the last couple
of months have been a huge mess for me, while David was
doing some <a href="https://github.com/congow/Orient/tree/persistence">major experiments</a>
for the library: we only had the time, at the end of March,
to talk about OrientDB and the ODM at the
<a href="http://www.slideshare.net/ingdavidino/graph-db-inphp">Codemotion</a>.</p>

<p>Since in the last week we restarted pairing together to
finalize a few open things in the library, I will explain what
is the current status of Orient.</p>

<h2>Beta-5</h2>

<p>We decided to put back our effort on the <code>beta-5</code> release,
instead of letting me complete the issues still belonging
to this version by myself.</p>

<p>In these days we are finalizing the integration tests for
OrientDB&#8217;s native data types, and refactoring a bit the
implementation of the <strong>hydration mechanism</strong>, which will be more
configurable: we will release an ODM able to let the developer
decide what to do when an hydration error occurs (in other words,
you mapped an attribute as integer but in the OrientDB record
that attribute is mistakenly set as a date): before this
refactoring process <code>null</code> was returned by default, but now
you&#8217;ll be able to decide whether to <a href="https://github.com/congow/Orient/blob/master/src/Congow/Orient/Formatter/Caster.php#L520">force the casting or raise an exception</a> for these errors.</p>

<p>As we complete these 2 tasks, we will remove the TODOs from
the codebase and then we will release this version which,
I remind it for those who are not up-2-date with the library&#8217;s
lifecycle, is the one introducing <strong>hydration</strong>, which is the
ability to run SQL queries against an OrientDB instance and map
the results as PHP objects.</p>

<p>Similarly to Doctrine2, Orient offers the ability to map objects
from PHP to OrientDB via annotations:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Congow\Orient\ODM\Mapper\Annotations</span> <span class="k">as</span> <span class="nx">ODM</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd">* @ODM\Document(class=&quot;Address&quot;)</span>
</span><span class='line'><span class="sd">*/</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Address</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @ODM\Property(type=&quot;link&quot;)</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="nv">$city</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Doctrine ODM</h2>

<p>From the beginning, we&#8217;ve been committed in finding a way to make
<a href="https://github.com/congow/Orient/blob/master/src/Congow/Orient/Contract/Protocol/Adapter.php#L23">interoperability</a>
a feature of Orient: another side of this issue is the fact that
we tried to stick to Doctrine2&#8217;s design for lots of our problems,
from the implementation of mapping to lazy-loading through
auto-generated proxy classes.</p>

<p>In the last weeks I pro-actively asked the Doctrine2 community if they
would be happy in welcoming this project in their community, and the
responses we received were positive: as a result, after going out with
the <code>beta-5</code> release we will refactor the library&#8217;s namespaces and move
the repository on Github.</p>

<p>There will be lots of things to do, lot of code to refactor, lot of
complaints from the Doctrine2 core members because of our &#8220;strange&#8221;
code, but this is a huge step towards a more robust PHP library
for OrientDB.</p>

<h2>Beta-6</h2>

<p>After the incubation inside the Doctrine organization we will re-start
working on the <code>beta-6</code> version, which will bundle <strong>persistence</strong> - the
ability to persist mapped PHP objects into OrientDB, using a couple
well known design patterns like the <a href="http://martinfowler.com/eaaCatalog/unitOfWork.html">unit of work</a>
and the <a href="http://martinfowler.com/eaaCatalog/identityMap.html">identity map</a>.</p>

<p>I won&#8217;t commit myself in an estimate: <strong>this will take a long time</strong>,
especially if only me and <a href="http://davidfunaro.com">David</a> will keep
the good work on this library.</p>

<p>But since we had <strong>huge contributions</strong> from
<a href="https://github.com/nrk">Daniele Alessandri</a> and
are gonna be part of the Doctrine community, I bet we will be able to
deliver what promised in less than then what I currently think.</p>

<h2>RC</h2>

<p>Last but not least, there will be a few planned refactorings and feature
add-ons that we don&#8217;t need now but are mandatory for a decent stable
version, which will come as we roll out our first <code>RC</code>.</p>

<h2>Thanks, again</h2>

<p>I could not keep my effort and motivation constant during
<a href="https://github.com/congow/Orient/commit/65929ec57a2e2cb1f4af034d722e17b5339b9d48">this year</a>
without your many &#8220;thank you&#8221;, your enthusiasm and
encouraging words: this is what makes me eager to type
with my fat fingers new LoCs dealing with PHP and NoSQL.</p>

<p>This won&#8217;t be a library I wrote<sup id='fnref:1'><a href='#fn:1' rel='footnote'>1</a></sup>, this is something an entire
community was waiting for and contributed to.</p>

<p>So, <em>thank y&#8217;all</em>.</p>

<div class="footnotes">
<span>
Notes
</span>
    <ol>
        <li id='fn:1'>Although I still remember the first commit on Github: I was only wearing my underwear, alone in the hall of my flat <a href='#fnref:1' rev='footnote'>↩</a></li>
    </ol>
</div>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Y U NO access WHOIS informations in PHP?]]></title>
    <link href="http://www.odino.org/y-u-no-access-whois-informations-in-php/"/>
    <updated>2012-04-16T00:38:00+04:00</updated>
    <id>http://www.odino.org/y-u-no-access-whois-informations-in-php</id>
    <content type="html"><![CDATA[<ol class="aseries">
    <p>This post is part of the &#8221;<strong>WHOIS in PHP: consuming the Robowhois API</strong>&#8221; series; here is a list of all the articles contained this series:</p>
    <li>
        <a href="http://www.odino.org/a-php-library-to-retrieve-whois-informations/">A PHP library to retrieve WHOIS informations</a>
    </li>
    <li>
        <a href="http://www.odino.org/retrieving-raw-whois-informations-in-php/">Retrieving raw WHOIS informations in PHP</a>
    </li>
    <li>
        <a href="http://www.odino.org/checking-a-domain-s-availability-with-php/">Checking a domain&#8217;s availability with PHP</a>
    </li>
  <li>
    <a href="http://www.odino.org/y-u-no-access-whois-informations-in-php/">Y U NO access WHOIS informations in PHP?</a>
  </li>
</ol>


<p>In these days we finalized the last parts of the official
<a href="https://github.com/robowhois/robowhois-php">PHP client for the Robowhois API</a>
, and here are the changes for the <code>0.9.0</code> version.</p>

<!-- more -->


<h2>Parts and properties API</h2>

<p>As part of our job, we needed to implement the last
2 API endpoints provided by Robowhois, <code>properties</code>
and <code>parts</code>.</p>

<p>Everything is documented in the
<a href="https://github.com/robowhois/robowhois-php/blob/master/README.md">README</a>
but you can also follow the examples under the <code>sample/</code> directory:</p>

<figure class='code'><figcaption><span>Using the properties API</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Robowhois\Robowhois</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Robowhois\Exception</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">require</span> <span class="s1">&#39;vendor/.composer/autoload.php&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$robowhois</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Robowhois</span><span class="p">(</span><span class="s1">&#39;INSERT-YOUR-API-KEY-HERE&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">try</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$domain</span> <span class="o">=</span> <span class="nv">$robowhois</span><span class="o">-&gt;</span><span class="na">whoisProperties</span><span class="p">(</span><span class="s1">&#39;robowhois.com&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">echo</span> <span class="nv">$domain</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;created_on&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;The following error occurred: &quot;</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Using the parts API</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Robowhois\Robowhois</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Robowhois\Exception</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">require</span> <span class="s1">&#39;vendor/.composer/autoload.php&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$robowhois</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Robowhois</span><span class="p">(</span><span class="s1">&#39;INSERT-YOUR-API-KEY-HERE&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">try</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$domain</span> <span class="o">=</span> <span class="nv">$robowhois</span><span class="o">-&gt;</span><span class="na">whoisParts</span><span class="p">(</span><span class="s1">&#39;robowhois.com&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">echo</span> <span class="nv">$domain</span><span class="p">[</span><span class="s1">&#39;parts&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;body&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;The following error occurred: &quot;</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Magic objects, behaving like arrays</h2>

<p>We implemented the <code>\ArrayObject</code> interface for the objects
returned by the API, which means that now you can access
the results of an API call just like an array:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$account</span> <span class="o">=</span> <span class="nv">$robowhois</span><span class="o">-&gt;</span><span class="na">account</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// $account is an instance of Robowhois\Account</span>
</span><span class='line'><span class="k">echo</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;You have %d API calls left&#39;</span><span class="p">,</span> <span class="nv">$account</span><span class="p">[</span><span class="s1">&#39;credits_remaining&#39;</span><span class="p">]);</span>
</span></code></pre></td></tr></table></div></figure>


<p>but, for those like us who like the OO synthax, we implemented
some magic to let you retrieve those values via getters, which
are built <em>on-the-fly</em> thanks to PHP&#8217;s <code>__call()</code> method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">echo</span> <span class="nv">$account</span><span class="o">-&gt;</span><span class="na">getCreditsRemaining</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>Getters are a camelized version of the array keys, and are
built thanks to the
<a href="https://github.com/robowhois/robowhois-php/blob/master/composer.json#L28">Doctrine Inflector</a>.</p>

<h2>Mapping the existing API</h2>

<p>We renamed the methods accessing the API in order to 100% reflect
the ones exposed by the API, also used in the
<a href="https://github.com/robowhois/robowhois-ruby">Ruby client</a>: so now the
<code>Robowhois\Robowhois</code> object has:</p>

<ul>
<li><code>-&gt;account()</code></li>
<li><code>-&gt;whois()</code></li>
<li><code>-&gt;whoisProperties()</code></li>
<li><code>-&gt;whoisParts()</code></li>
<li><code>-&gt;whoisRecord()</code></li>
<li><code>-&gt;whoisAvailability()</code></li>
</ul>


<h2>Simplified exceptions</h2>

<p>We initially added tons of exceptions but we eventually
decide to keep the only <code>Robowhois\Exception</code> class.</p>

<h2>Now?</h2>

<p>Wanna retrieve WHOIS informations in PHP at a
<a href="http://www.robowhois.com/pricing">decent price</a>?</p>

<p>Start consuming the Robowhois APIs, with PHP.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Search engines are making the web slower]]></title>
    <link href="http://www.odino.org/search-engines-are-making-the-web-slower/"/>
    <updated>2012-04-07T10:00:00+04:00</updated>
    <id>http://www.odino.org/search-engines-are-making-the-web-slower</id>
    <content type="html"><![CDATA[<p>Like it or not, pushing the work to the clients is
a tecnique which made the web able to scale the way
it is now: <strong>search engines are making it slower</strong> and
less scalable, as they don&#8217;t want us to do so.</p>

<!-- more -->


<p>The problem is that JavaScript - the <em>creepy</em> JavaScript -
is now recognized as a first-level programming language<sup id='fnref:1'><a href='#fn:1' rel='footnote'>1</a></sup>,
although SE are around since more than a decade: thus,
crawlers and spiders, although able to interpretate basic
JS code, cannot do more complex stuff, like managing
<a href="http://handlebarsjs.com/">Handlerbars</a> or <a href="http://mnot.github.com/hinclude/">HInclude</a>.</p>

<p>Or, at least, we don&#8217;t know if they can.</p>

<p>There would be a workaround to this kind of issue, by just
<strong>serving different content for JS-aware clients</strong>, so that a
spider could see the whole resource without the need of
executing JS code: a workaround that would cost in terms of
development time, but still an acceptable workaround.</p>

<p>The problem, here, is that tis tecnique, known as <a href="http://en.wikipedia.org/wiki/Cloaking">cloacking</a>
is part of the <a href="http://en.wikipedia.org/wiki/Search_engine_optimization#White_hat_versus_black_hat">black hat SEO</a> list, so you basically can&#8217;t take
advantage of it as malicious web developers would use
cloacking to serve keyword-stuffed contents to bots and
&#8220;normal&#8221; webpages to humans, and this is something you
really want to avoid, since SERPs&#8217; relevance is an
important part of a user&#8217;s eb experience.</p>

<p>But, at least, we don&#8217;t know how search engines would react
to the workaround I just explained.</p>

<h2>What do we need?</h2>

<p>We should have clarifications from SE vendors, to know whether
they are able or not to let us take advantage of great JS-based
technologies able to make our applications scale better, or - better -
have fully JS-aware spiders and crawlers, able to elaborate
resources like real-world browsers.</p>

<p>It&#8217;s not about me, it&#8217;s not about you, it&#8217;s about the web: a faster,
and <strong>definitely better</strong>, web.</p>

<div class="footnotes">
<span>
Notes
</span>
    <ol>
        <li id='fn:1'>Mainly because of the NodeJS hype <a href='#fnref:1' rev='footnote'>↩</a></li>
    </ol>
</div>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Wanna be hired? Go get yourself a blog and a github profile]]></title>
    <link href="http://www.odino.org/wanna-be-hired-go-get-yourself-a-blog-and-a-github-profile/"/>
    <updated>2012-03-27T11:32:00+04:00</updated>
    <id>http://www.odino.org/wanna-be-hired-go-get-yourself-a-blog-and-a-github-profile</id>
    <content type="html"><![CDATA[<p>As part of my last days in <a href="http://dnsee.com">DNSEE</a> and first days in
<a href="http://rocket-internet.de">Rocket</a> I&#8217;m involved in two recruitment processes
and after the huge amount of CVs we got for DNSEE after the
<a href="http://www.codemotion.it/">Codemotion</a> I thought it would be good to
share some thoughts about <strong>my</strong> recruiting habits.</p>

<!-- more -->


<h2>European format</h2>

<p>First of all, <strong>forget about the <a href="http://en.wikipedia.org/wiki/Europass">european CV format</a></strong>:
it works when you want to work in a body rental Java company and want to
be identified with a mere number (and if you want to end up like that,
stop reading this article)<sup id='fnref:1'><a href='#fn:1' rel='footnote'>1</a></sup>.</p>

<p><img class="left" src="http://www.odino.org/images/hipster.glasses.jpg"></p>

<p>Some months ago someone on Twitter was suggesting to move the CV on
<a href="http://slideshare.net">slideshare</a>, something I really wanted to do - but
I never took the time to do so: bare in mind that reading a CV can be
funny at the beginning of the hiring process, but as you get tons of
applies, it becomes - as everything - a repetitive, thus annoying,
activity, so putting a bit of creativity on your CV will be considered
as a huge plus; <strong>the more you attract, the less you&#8217;ll be considered
the average</strong>.</p>

<p>The european format just does not work when you need to highlight
your motivation and expertise you have on interesting practices,
which is what I basically look for, at least for a first glance.</p>

<h2>It&#8217;s not where you worked unless it was The Place</h2>

<p><img class="right" src="http://www.odino.org/images/virgin.jpg"></p>

<p>It&#8217;s pretty common to see dozens of working experiences in a CV,
without a deep description of the position held and a summary of
your daily duties.</p>

<p>Do you think people care about <strong>where</strong> you worked or <strong>what</strong> you did?</p>

<p>Unless you have been working for some major, people won&#8217;t care about
your employer because it will never add anything to your profile, it&#8217;s
just a (bad) sign that you worked for N years at this place.</p>

<p>What I suggest is to <strong>add various aspects of your working experience</strong>,
like big customers you had to deal with, good practices like TDD or
- in general - automated test and what you brought inside the company,
like a new approach to development or a (new) technology which was
suitable for their use-case.</p>

<h2>Ideal code VS production one</h2>

<blockquote><p>Any developer can show you diamonds, but a few are able not to deliver crap to your customers.</p></blockquote>


<p>Let&#8217;s be honest for a moment: <strong>production code isn&#8217;t ideal code</strong><sup id='fnref:2'><a href='#fn:2' rel='footnote'>2</a></sup>.</p>

<p>Technical debt is something we are used to deal with and it&#8217;s not <em>that</em> big issue:
I like when developers admit that under difficult circumstances,
they took creepy shortcuts to overcome an issue which needed to
be fixed in a relatively short amount of time.</p>

<p>So, given that you won&#8217;t show your next employer your production code
(since it is intellectual property of your current company or customers)
it would be nice if you show them the top line of your skiils, maybe
via a Github profile; doing so, you give the chance to take a
look at your best code.</p>

<p><img class="right" src="http://www.odino.org/images/hand.jpg"></p>

<h2>Why don&#8217;t you share your thoughts with me?</h2>

<p>A big plus would be reading your blog wherever - blogspot,
posterous, etc - to gain confidence with your ideas and
what you like to talk about when not (necessarily) coding
for your current company.</p>

<p>Blogging, also once in a month, gives you the possibility
to be evaluated without the need to do anything: reading your
posts will make recruiters get in touch with you, as a person,
your style, coding skills, aims and so on.</p>

<h2>MS Excel, really?</h2>

<p>Please stop mentioning know-how on the following subjects:</p>

<ul>
<li>MS Word</li>
<li>MS Excel</li>
<li>Photoshop</li>
<li>Dreamweaver</li>
<li><em>stuff like that</em></li>
</ul>


<p>because they will make you look like <strong>a developer who doesn&#8217;t understand
its precise scope</strong>.</p>

<h2>So what?</h2>

<p>Do I have to mention that I would like to see great people joining me
and <a href="http://www.linkedin.com/company/rocket-internet-gmbh/careers">Rocket</a>
in Dubai or my former <a href="http://www.linkedin.com/company/dnsee/careers">DNSEE colleagues</a>
in Rome?</p>

<p>I did it :)</p>

<div class="footnotes">
<span>
Notes
</span>
    <ol>
        <li id='fn:1'>I give this advice although I have an Europass CV, but - as I like to say - it&#8217;s a raped-european-format CV, so not as standard as you might think <a href='#fnref:1' rev='footnote'>↩</a></li><li id='fn:2'>Since production code has a deadline and ideal code is a never-ending refactoring, I won&#8217;t listen to any objection here <a href='#fnref:2' rev='footnote'>↩</a></li>
    </ol>
</div>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Checking a domain's availability with PHP]]></title>
    <link href="http://www.odino.org/checking-a-domain-s-availability-with-php/"/>
    <updated>2012-03-20T09:49:00+04:00</updated>
    <id>http://www.odino.org/checking-a-domain-s-availability-with-php</id>
    <content type="html"><![CDATA[<ol class="aseries">
    <p>This post is part of the &#8221;<strong>WHOIS in PHP: consuming the Robowhois API</strong>&#8221; series; here is a list of all the articles contained this series:</p>
    <li>
        <a href="http://www.odino.org/a-php-library-to-retrieve-whois-informations/">A PHP library to retrieve WHOIS informations</a>
    </li>
    <li>
        <a href="http://www.odino.org/retrieving-raw-whois-informations-in-php/">Retrieving raw WHOIS informations in PHP</a>
    </li>
    <li>
        <a href="http://www.odino.org/checking-a-domain-s-availability-with-php/">Checking a domain&#8217;s availability with PHP</a>
    </li>
  <li>
    <a href="http://www.odino.org/y-u-no-access-whois-informations-in-php/">Y U NO access WHOIS informations in PHP?</a>
  </li>
</ol>


<p>It&#8217;s been a while I don&#8217;t blog about the
<a href="https://github.com/robowhois/robowhois-php">Robowhois PHP client</a> that I&#8217;m developing
together with <a href="http://davidfunaro.com">David</a> so, since we recently released
the <code>0.8.0</code> version I want to share with you what you can do with it now.</p>

<!-- more -->


<h2>Checking a domain&#8217;s availability</h2>

<p>The <a href="http://docs.robowhois.com/api/whois/">availability API</a> is probably the
greatest feature of the <a href="http://www.robowhois.com/">Robowhois</a> webservice,
letting you check for a domain&#8217;s availability with a simple, uniform HTTP
request.</p>

<figure class='code'><figcaption><span>Checking if google.com is available</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Robowhois\Robowhois</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$robowhois</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Robowhois</span><span class="p">(</span><span class="s1">&#39;INSERT-YOUR-API-KEY-HERE&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nv">$robowhois</span><span class="o">-&gt;</span><span class="na">isAvailable</span><span class="p">(</span><span class="s1">&#39;google.com&#39;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;pretty nice dream, uhm?&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The opposite thing is achieved using the <code>-&gt;isRegistered()</code> method.</p>

<p>You can also retrieve an array as returned from the webservice, by doing:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Robowhois\Robowhois</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$robowhois</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Robowhois</span><span class="p">(</span><span class="s1">&#39;INSERT-YOUR-API-KEY-HERE&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nv">$availability</span> <span class="o">=</span> <span class="nv">$robowhois</span><span class="o">-&gt;</span><span class="na">whoisAvailability</span><span class="p">(</span><span class="s1">&#39;google.com&#39;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$availability</span><span class="p">[</span><span class="s1">&#39;available&#39;</span><span class="p">];</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$availability</span><span class="p">[</span><span class="s1">&#39;registered&#39;</span><span class="p">];</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$availability</span><span class="p">[</span><span class="s1">&#39;daystamp&#39;</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Retrieve informations about your account</h2>

<p>A <em>must-have</em>, since you should always check how many remaining credits
you have, the <code>account</code> API lets you retrieve some of your personal data
from your Robowhois.com account:</p>

<figure class='code'><figcaption><span>Calculating how many left credits you have</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Robowhois\Robowhois</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$robowhois</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Robowhois</span><span class="p">(</span><span class="s1">&#39;INSERT-YOUR-API-KEY-HERE&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">try</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$credits</span> <span class="o">=</span> <span class="nv">$robowhois</span><span class="o">-&gt;</span><span class="na">whoisAccount</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getCreditsRemaining</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nv">$credits</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="k">echo</span> <span class="s2">&quot;No problem fella!&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>              <span class="k">echo</span> <span class="s2">&quot;Time to go shopping looking for new API calls, uhm?&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;The following error occurred: &quot;</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Minor things</h2>

<p>We also polished some code, refactored stuff and added some tests (unit and
integration ones).</p>

<p>For instance, when using the <code>record</code> API, you can retrieve the daystamp of the
response as <code>DateTime</code> object:</p>

<figure class='code'><figcaption><span>retrieving the daystamp as an object or a string</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Robowhois\Robowhois</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$robowhois</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Robowhois</span><span class="p">(</span><span class="s1">&#39;INSERT-YOUR-API-KEY-HERE&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nv">$whois</span> <span class="o">=</span> <span class="nv">$robowhois</span><span class="o">-&gt;</span><span class="na">whoisRecord</span><span class="p">(</span><span class="s1">&#39;google.com&#39;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// returns a DateTime object</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$whois</span><span class="o">-&gt;</span><span class="na">getDaystamp</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// formats the DateTime</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$whois</span><span class="o">-&gt;</span><span class="na">getDaystamp</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// returns a string</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$whois</span><span class="o">-&gt;</span><span class="na">getDaystamp</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can download the <a href="https://github.com/robowhois/robowhois-php/tree/0.8.0">latest tag</a>
of the library (currently <code>0.8.0</code>) and start using it: the <a href="https://github.com/robowhois/robowhois-php/blob/master/README.md">README</a>
exhaustively explains what you can do with this small client, and some
<a href="https://github.com/robowhois/robowhois-php/tree/master/sample">samples</a>
are provided under the <code>sample</code> directory.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Moving to Dubai]]></title>
    <link href="http://www.odino.org/moving-to-dubai/"/>
    <updated>2012-03-05T10:00:00+04:00</updated>
    <id>http://www.odino.org/moving-to-dubai</id>
    <content type="html"><![CDATA[<p>Yes, you got it.</p>

<!-- more -->


<p>Last thursday I resigned from my lead developer position at <a href="http://dnsee.com">DNSEE</a>
to be able to join <a href="http://www.rocket-internet.de/">Rocket Internet</a> for their exciting projects
in the middle east area.</p>

<p>After more than 2 years in DNSEE, I really owe everyone a hug, and I gotta
say I&#8217;m pretty excited for my relocation, which is gonna lead me to Dubai on the 30 or 31
of this month.</p>

<p>I will be in charge of one of the teams in Dubai, reporting to <a href="http://de.linkedin.com/in/halilkoklu">Halil</a>, as a team leader.</p>

<p>I have no words, really: after a brief visit to my parents (it has been a very sad weekend, believe me),
I&#8217;m just <strong>so excited</strong> to start this new challenge.</p>

<p>Wish me luck guys, wish me luck.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Scaling asynchronously through HInclude]]></title>
    <link href="http://www.odino.org/scaling-through-hinclude/"/>
    <updated>2012-02-24T10:50:00+04:00</updated>
    <id>http://www.odino.org/scaling-through-hinclude</id>
    <content type="html"><![CDATA[<p>Since it&#8217;s been a while that I spread the idea of
having <a href="http://www.odino.org/edge-side-includes-how-to-spare-terabytes-every-day/">ESI on the client side</a>,
someone pointed out that a good solution, technically
different from the one I personally proposed, would
be to use JavaScript to and asynchronous sub-requests.</p>

<!-- more -->


<p>There is a small JS library, written by the good
<a href="http://www.mnot.net/">Mark Nottingham</a><sup id='fnref:1'><a href='#fn:1' rel='footnote'>1</a></sup>,
called <a href="http://mnot.github.com/hinclude/">HInclude</a>,
which does this kind of job.</p>

<h2>The problem</h2>

<p>Consider that you have an high-traffic websites which has
some parts of its webpages that rarely change, like the header,
the footer and some sidebars: why should you regenerate all
those parts at every request?</p>

<p><a href="http://www.w3.org/TR/esi-lang">ESI</a> solves this kind
of problem, but requires you to make a request through the
network, as you need, at least, to hit the reverse proxy,
which then handles the composition on a resource with
sub-resources.</p>

<p>As I <a href="http://www.odino.org/edge-side-includes-how-to-spare-terabytes-every-day/">stated earlier</a>,
this is not an optimal approach for every <em>use-case</em>, so you
definitely should try to use local caches (your users) to
scale better.</p>

<h2>The solution</h2>

<p>HInclude fits perfectly in this context, as you only need to
include the JS and add a namespace declaration to your documents:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>  <span class="nt">&lt;html</span> <span class="na">xmlns:hx=</span><span class="s">&quot;http://purl.org/NET/hinclude&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;head&gt;</span>
</span><span class='line'>      <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;/lib/hinclude.js&quot;</span>
</span><span class='line'>       <span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>whenever you need to aggregate data from a sub-resource you
only need to <strong>add an hinclude tag</strong>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;hx:include</span> <span class="na">src=</span><span class="s">&quot;/header.html&quot;</span><span class="nt">&gt;&lt;/hx:include&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can specify a default content - if the user has not javascript
or whatever - and it provides a nice behaviour when the sub-request
generates an error (status codes different from <code>200</code> and <code>304</code>), as
it adds an <code>hinclude_$statusCode</code> class to the tag.</p>

<h2>A dummy benchmark</h2>

<p>I provide here a benchmark, a simple and silly one, as you should be
already able to understand the power of HInclude.</p>

<p>First of all let&#8217;s create a simple response, which aggregates header
and footer directly from PHP, as we are used to do:</p>

<figure class='code'><figcaption><span>index_no_hinclude.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">&lt;html&gt;</span>
</span><span class='line'><span class="x">    &lt;head&gt;</span>
</span><span class='line'><span class="x">    &lt;/head&gt;</span>
</span><span class='line'><span class="x">    &lt;body&gt;</span>
</span><span class='line'><span class="x">      &lt;p&gt;</span>
</span><span class='line'><span class="x">        </span><span class="cp">&lt;?php</span> <span class="k">include</span> <span class="s1">&#39;header.php&#39;</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">      &lt;/p&gt;</span>
</span><span class='line'><span class="x">      &lt;div class=&quot;main&quot;&gt;</span>
</span><span class='line'><span class="x">        &lt;!-- start slipsum code --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="x">        Look, just because I don&#39;t be givin&#39; no man a foot massage don&#39;t make it right for Marsellus to throw Antwone into a glass motherfuckin&#39; house, fuckin&#39; up the way the nigger talks. Motherfucker do that shit to me, he better paralyze my ass, &#39;cause I&#39;ll kill the motherfucker, know what I&#39;m sayin&#39;?</span>
</span><span class='line'>
</span><span class='line'><span class="x">        &lt;!-- please do not remove this line --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="x">        &lt;div style=&quot;display:none;&quot;&gt;</span>
</span><span class='line'><span class="x">        &lt;a href=&quot;http://slipsum.com&quot;&gt;lorem ipsum&lt;/a&gt;&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="x">        &lt;!-- end slipsum code --&gt;</span>
</span><span class='line'><span class="x">      &lt;/div&gt;</span>
</span><span class='line'><span class="x">      &lt;p&gt;</span>
</span><span class='line'><span class="x">        </span><span class="cp">&lt;?php</span> <span class="k">include</span> <span class="s1">&#39;footer.php&#39;</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">      &lt;/p&gt;</span>
</span><span class='line'><span class="x">    &lt;/body&gt;</span>
</span><span class='line'><span class="x">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>and then the header and footer files:</p>

<figure class='code'><figcaption><span>header.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span> <span class="nb">usleep</span><span class="p">(</span><span class="mi">200000</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;!-- start slipsum code --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="x">You think water moves fast? You should see ice. It moves like it has a mind. Like it knows it killed the world once and got a taste for murder. After the avalanche, it took us a week to climb out. Now, I don&#39;t know exactly when we turned on each other, but I know that seven of us survived the slide... and only five made it out. Now we took an oath, that I&#39;m breaking now. We said we&#39;d say it was the snow that killed the other two, but it wasn&#39;t. Nature is lethal but it doesn&#39;t hold a candle to man.</span>
</span><span class='line'>
</span><span class='line'><span class="x">&lt;!-- please do not remove this line --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="x">&lt;div style=&quot;display:none;&quot;&gt;</span>
</span><span class='line'><span class="x">&lt;a href=&quot;http://slipsum.com&quot;&gt;lorem ipsum&lt;/a&gt;&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="x">&lt;!-- end slipsum code --&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>footer.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span> <span class="nb">usleep</span><span class="p">(</span><span class="mi">200000</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;!-- start slipsum code --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="x">Normally, both your asses would be dead as fucking fried chicken, but you happen to pull this shit while I&#39;m in a transitional period so I don&#39;t wanna kill you, I wanna help you. But I can&#39;t give you this case, it don&#39;t belong to me. Besides, I&#39;ve already been through too much shit this morning over this case to hand it over to your dumb ass.</span>
</span><span class='line'>
</span><span class='line'><span class="x">&lt;!-- please do not remove this line --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="x">&lt;div style=&quot;display:none;&quot;&gt;</span>
</span><span class='line'><span class="x">&lt;a href=&quot;http://slipsum.com&quot;&gt;lorem ipsum&lt;/a&gt;&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="x">&lt;!-- end slipsum code --&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Bear in mind that I use</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span> <span class="nb">usleep</span><span class="p">(</span><span class="mi">200000</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>to simulate some php code execution (<code>200ms</code> seems a
reasonable amount of time - inspired by one of our
live projects).</p>

<p>I took a look at Chrome&#8217;s timeline bar to get an idea of
the average time spent for rendering this resource, and it
was <code>~450ms</code>.</p>

<p>If you try to use HInclude, just create a new page:</p>

<figure class='code'><figcaption><span>index_hinclude.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;html</span> <span class="na">xmlns:hx=</span><span class="s">&quot;http://purl.org/NET/hinclude&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;head&gt;</span>
</span><span class='line'>      <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;src/hinclude.js&quot;</span>
</span><span class='line'>       <span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;body&gt;</span>
</span><span class='line'>      <span class="nt">&lt;p&gt;</span>
</span><span class='line'>        <span class="nt">&lt;hx:include</span> <span class="na">src=</span><span class="s">&quot;header.php&quot;</span><span class="nt">&gt;&lt;/hx:include&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/p&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;main&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="c">&lt;!-- start slipsum code --&gt;</span>
</span><span class='line'>
</span><span class='line'>        Look, just because I don&#39;t be givin&#39; no man a foot massage don&#39;t make it right for Marsellus to throw Antwone into a glass motherfuckin&#39; house, fuckin&#39; up the way the nigger talks. Motherfucker do that shit to me, he better paralyze my ass, &#39;cause I&#39;ll kill the motherfucker, know what I&#39;m sayin&#39;?
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!-- please do not remove this line --&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;display:none;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://slipsum.com&quot;</span><span class="nt">&gt;</span>lorem ipsum<span class="nt">&lt;/a&gt;&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!-- end slipsum code --&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;p&gt;</span>
</span><span class='line'>        <span class="nt">&lt;hx:include</span> <span class="na">src=</span><span class="s">&quot;footer.php&quot;</span><span class="nt">&gt;&lt;/hx:include&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/p&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>and add, in <code>header.php</code> and <code>footer.php</code>, a caching header,
which HInclude will made the browser take advantage of:</p>

<figure class='code'><figcaption><span>At the top of header.php and footer.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span> <span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Cache-Control: max-age=3600&#39;</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>For the first user requests it will require <code>~220ms</code> to render
the whole page: this is a pretty good starting gain, as we are
<strong>requesting header and footer in parallel</strong>, but as you retrieve
the page for the second time, performances will incredibly
improve, down to <code>~40/50ms</code>: it&#8217;s, basically, a <strong>90% performance
gain</strong>, but you should be aware that the biggest load time should
be spent within the main body of the page, that I just ignored in
this example; but gaining almost a half second for each pageview
is just a great goal achieved.</p>

<p>As pointed out by other people on twitter, HInclude has a few
drawbacks - think about
<a href="https://twitter.com/#!/lyrixx/status/172849248868646912">SEO</a> -
but you should be able to use it with contents that rarely need
to play a major role in your SEO strategy (eg. never use HInclude
to retrieve the body of a blog post<sup id='fnref:2'><a href='#fn:2' rel='footnote'>2</a></sup>).</p>

<div class="footnotes">
<span>
Notes
</span>
    <ol>
        <li id='fn:1'>You should know him for his contributions to the HTTP specification, httpbis, cache channels and - in general - the HTTP cache <a href='#fnref:1' rev='footnote'>↩</a></li><li id='fn:2'>Recently Matt Cutts came out with the assertion that Googlebot is capable to understand basic JS redirects, so&#8230; there&#8217;s hope <a href='#fnref:2' rev='footnote'>↩</a></li>
    </ol>
</div>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Book review: Data-Intensive Text Processing with MapReduce]]></title>
    <link href="http://www.odino.org/book-review-data-intensive-text-processing-with-mapreduce/"/>
    <updated>2012-02-23T12:57:00+04:00</updated>
    <id>http://www.odino.org/book-review-data-intensive-text-processing-with-mapreduce</id>
    <content type="html"><![CDATA[<p>As part of my studies not directly connected to my job,
in the last month I&#8217;ve finished this interesting book, which
gives you a good overview about
<a href="http://en.wikipedia.org/wiki/MapReduce">MapReduce</a>.</p>

<!-- more -->


<p><img class="right" src="http://www.odino.org/images/mapreduce.book.jpg"></p>

<p><a href="http://www.umiacs.umd.edu/~jimmylin/">Jimmy Lin</a> and Chris
Dyer nailed this one: the book is really clear and leaves
room for further studies, maybe more practical ones: the book
starts with the definition of MapReduce, from the algorithm to
the execution framework and the analyzes each part of the
algorithm and theyr variants in some frameworks, like
Hadoop<sup id='fnref:1'><a href='#fn:1' rel='footnote'>1</a></sup>.</p>

<p>After studying the components of MapReduce you will
take a practical look at possible implementations<sup id='fnref:2'><a href='#fn:2' rel='footnote'>2</a></sup>,
from graph algorithms to the pagerank one: note that there are
so many references in the book, so if you will be into it, you&#8217;re
gonna find yourself screwed in a <em>nerdy</em> loop :)</p>

<p>The EM chapter (dealing with <em>expectation-maximization</em> algorithms)
was pretty difficult for me, as it&#8217;s too much time that I don&#8217;t
take math <em>that</em> seriously, but I - however - was able to
follow all the theory explained there.</p>

<p>Something that I really appreciated was the closing remark stating that,
just like every technology, is not the right pick for every problem -
think about <strong>stateful</strong> large scale data-processing algorithms.</p>

<p>I strongly recommend you to read such this kind of book: the approach
followed by the writers is so engineered and some examples they give,
like the <a href="http://www.odino.org/quality-isnt-always-better-than-quality/">stupid backoff</a>,
are pearls for your working experience.</p>

<div class="footnotes">
<span>
Notes
</span>
    <ol>
        <li id='fn:1'>But please remember, this book is not any kind of Hadoop guide <a href='#fnref:1' rev='footnote'>↩</a></li><li id='fn:2'>Which are code-agnostic, as everything is written in a pretty clear pseudo-code <a href='#fnref:2' rev='footnote'>↩</a></li>
    </ol>
</div>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to argue with junior and stubborn developers]]></title>
    <link href="http://www.odino.org/how-to-argue-with-junior-and-stubborn-developers/"/>
    <updated>2012-02-23T12:00:00+04:00</updated>
    <id>http://www.odino.org/how-to-argue-with-junior-and-stubborn-developers</id>
    <content type="html"><![CDATA[<p>In these days I had a nice chat with
<a href="http://www.linkedin.com/in/gogebakan">Önder Göğebakan</a> to exchange
some views about <strong>team leading</strong>: one of the points I loved to face
was how to deal with arrogant coders that <strong>don&#8217;t want to consider
the indications received from their technical lead</strong>.</p>

<!-- more -->


<h2>Pulling responsabilites is not that bad</h2>

<p>It makes no difference the reason why the developers is going against your
opinion/advice/dictation: it may be due to inexperience or attitude, and this
is not <em>that</em> bad.</p>

<p><img class="right" src="http://www.odino.org/images/rooster.jpg"></p>

<p>A developer which pulls responsabilities shows a good attitude, as it
demonstrates that he wants to take a decision based on different variables
evaluated differently than you: passive coders<sup id='fnref:1'><a href='#fn:1' rel='footnote'>1</a></sup> are just a bad
smell within your organization, because they won&#8217;t ever be as productive
as you might need; don&#8217;t get me wrong on this: <strong>passive developers are
a valuable asset</strong>, as you can&#8217;t rely on a team of cocks, but you
shouldn&#8217;t hire too many passives, since, in a team of 4~6 people there
will be room for 1, maybe 2, washermen.</p>

<p>Push systems are just a bad idea: if you throw duties and responsabilities
to your developers they won&#8217;t feel comfortable with them and will suddenly
fear the assigned tasks; make a developer pull his responsabilities and you
will be able to work in a strongy energized, motivated, self aware and
fast growing team<sup id='fnref:2'><a href='#fn:2' rel='footnote'>2</a></sup>.</p>

<p>If you will ever be in troubles when a proactive developer go against
your decision, I want to share with you a few thoughts on that.</p>

<h2>Use exampl&#8230;your experience</h2>

<p>Being a CTO, team leader, technical fellow or whatever, you gained
so much experience from your previous &#8220;developer&#8217;s years&#8221; that you have
an unvaluable knowledge about problem solving, and when I say
unvaluable I mean that there&#8217;s no inexperienced brain that could
overcome a seasoned veteran.</p>

<p><img class="left" src="http://www.odino.org/images/jordan.jpg"></p>

<p>Think about the way you solved that technical problem earlier in your
career and start adding examples to your cause: don&#8217;t pretend to
think that this new problem &#8220;it&#8217;s just the same I saw in <code>some company</code>
back in 2001&#8221;, because the developer will think that your are
just scratching the surface of the issue and will look at you
with no trust.</p>

<p>When Michael Jordan got back into the NBA for the second time,
with the partially self-owned team of the Washington Wizards,
he was 38, and wasn&#8217;t able to provide the physical strength,
speed and responsiveness that he had back on his 20s.</p>

<p>Although all of this, the great thing that Mike did was to <strong>take
advantage of his experience</strong> to overcome youger players and
rough defenders: without a fully-supporting body, he was able to
perform great games, with a
<a href="http://www.basketball-reference.com/boxscores/200112290WAS.html">51-points legendary performance</a>
against the Charlotte Hornets, just to mention one episode.</p>

<p>At 38.</p>

<p>Don&#8217;t think your technical knowledge will be as exhaustive as
during your full-development period, but take advantage of the
situations occurred during those valuable years.</p>

<h2>Approach the problem from different points of view</h2>

<p><img class="right" src="http://www.odino.org/images/sheldon.board.jpg"></p>

<p><a href="http://en.wikipedia.org/wiki/Sheldon_Cooper">Sheldon Cooper</a>
has a huge problem in his life: he&#8217;s not open to
look at the situations he faces from perspectives different
from his own one.</p>

<p>This makes impossible, for him, to solve decisional problems
taking different looks, from different point of views: one
aspect of your job is to provide different solutions to the
same problem instead.</p>

<p>Solutions may be incomplete, or may be not suitable for the
developer against you, but will help you in gaining trust when
explaining your points: someone stucked to his view may be
considered stubborn and not qualificated, but if you are able
to <strong>provide different pros and cons to different solutions</strong>
you will get respect from the person at the other side of
the argument, as you will be recognized not as a firm
believer, but as a thinker.</p>

<h2>Make spikes</h2>

<p>It may sound inefficient, but spikes are a good way to bring your
result home: you are not meant to directly write a spike for a
<em>use case</em> but you should <strong>encourage the counterpart to start
writing small and rough pieces of code</strong> to test if some of the
solutions he thiks are gonna work seem to be working fine.</p>

<p><img class="left" src="http://www.odino.org/images/lego.technic.jpg"></p>

<p>This makes the developer feel that he&#8217;s  gaining trust from you,
as he is allowed to actually spend some billable time on his
implementation, but as some problem comes out ask him how to
solve it: a good developer may immediately find that he was wrong
about it, so your problem is solved; if he keeps trying to follow
this deadly way - maybe for <a href="http://c2.com/cgi/wiki?CowboyCoder">pride</a>
- just move at the subsequent step, which means making the
developer recognise he needs help.</p>

<p>Bear in mind that whenever you decide to make a spike, something
practical actually happens, and it could turn out that the
implementation you were criticizing may accomplish its duty:
since no one is perfect prepare your words to congratulate with
the developer and thank him for the good approach, <strong>without
feeling embarassed</strong>.</p>

<p><img class="right" src="http://www.odino.org/images/socrates.gif"></p>

<h2>Consolidate doubts</h2>

<p>With a <a href="http://en.wikipedia.org/wiki/Socratic_method">socratic approach</a>,
as you see that he is developing some spikes but <strong>comes to
unacceptable endpoints</strong>, start smashing his beliefs pointing
out the flaws his design has, the possible problems that you are
going to face and the limitations that this piece of code will
bring to his direct components - just to mention a few possible
type of problems.</p>

<p>I strongly recommend you to read
<a href="http://en.wikipedia.org/wiki/The_Republic_(Plato)">The Republic</a>,
by Plato, to understand how the socratic approach works in
practice: it&#8217;s a really good practice to <strong>rely on ancient wisdom</strong>
to solve inter-people issues, as this kind of knowledge is
transversal to any kind of context.</p>

<h2>Give trust, feed the monster and save him before death</h2>

<p>May 8, 1970: <a href="http://en.wikipedia.org/wiki/Willis_Reed">Willis Reed</a>,
captain and leader of the
<a href="http://www.nba.com/knicks/">New York Knickerbockers</a> is
injured, and the Knicks need to defeat the Los Angeles Lakers
in game 7 (last game of a 3-3 tied series) to become NBA champions.</p>

<p><img class="right" src="http://www.odino.org/images/walt.frazier.jpg"></p>

<p>Willis starts the game, sinks down the first two points for New York
with a perimetral shot and, well, then he stops there.</p>

<p>Your developer is Reed: he&#8217;s under pressure, feels he can&#8217;t solve
the situation but dramatically tries not to drown; <strong>there comes Walt</strong>.</p>

<p><a href="http://en.wikipedia.org/wiki/Walt_Frazier">Walt Frazier</a> is a
tiny little point guard, a decent scorer: he&#8217;s facing
LA&#8217;s <a href="http://en.wikipedia.org/wiki/Jerry_West">Jerry West</a>, one of the
legends of the NBA, named Mr. Clutch due to his ability to stay
focused and sink shots in high-pressure conditions.</p>

<p>Walt does not care: inspired by his captain, he puts together an awesome
performance, scoring 36 points, serving 19 assists and stealing several
balls from West&#8217;s hands.</p>

<p>Now it&#8217;s time - for you - to play as Walt &#8216;Clyde&#8217; Frazier: as the developer
is drowning down you need to come there, <strong>give him the advices</strong> to fix his
implementation and to get out of that situation, <strong>pair with him</strong> and make
him feel that <strong>you could also be in that situation</strong>, it&#8217;s not such a big
problem: doing this he will firmly listen to you, as you are leading
him out of troubles, the best way to gain respect from others.</p>

<h2>Gain trust</h2>

<p>The key to lead a team is gain trust from its components: it is rarely acceptable
that a team leader could lead his team with a cocky behaviour, so you are
going to fail if your only aim is to do <strong>people management</strong>, and not team
leading.</p>

<p>Letting people pull responsabilities, giving them trust, analyzing with the
team the problems which may occur after a decision (an implementation, or
the change of a process), involving everyone in your job.</p>

<p>As I like to state:</p>

<blockquote><p>Great leaders let other leaders emerge.</p></blockquote>


<h2>Be humble and step back</h2>

<p>What if you were wrong? It may happen, and it&#8217;s perfectly acceptable:
don&#8217;t be rude when supporting your ideas, because as it turns out
that you were wrong, this may harm your position.</p>

<p>If you sell yourself as a humble guy, you will get the trust of your
team, because <strong>they will recognize you as a wise guide</strong>, not a tyrant.</p>

<div class="footnotes">
<span>
Notes
</span>
    <ol>
        <li id='fn:1'>Monkeys <a href='#fnref:1' rev='footnote'>↩</a></li><li id='fn:2'>Worth to mention, the recruiting process plays a big role in this process <a href='#fnref:2' rev='footnote'>↩</a></li>
    </ol>
</div>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Create a Composer command line installer with the Symfony2 CLI]]></title>
    <link href="http://www.odino.org/install-composer-dependencies-with-the-symfony2-cli/"/>
    <updated>2012-02-21T10:51:00+04:00</updated>
    <id>http://www.odino.org/install-composer-dependencies-with-the-symfony2-cli</id>
    <content type="html"><![CDATA[<ol class="aseries">
    <p>This post is part of the &#8221;<strong>Symfony2 components in your own userland</strong>&#8221; series; here is a list of all the articles contained this series:</p>
    <li>
        <a href="http://www.odino.org/using-the-symfony2-dependency-injection-container-as-a-standalone-component/">Using the Symfony2 Dependency Injection Container as a standalone component</a>
    </li>
    <li>
        <a href="http://www.odino.org/launching-phpunit-tests-from-a-browser-with-symfony2/">Launching PHPUnit tests from a browser with Symfony2</a>
    </li>
    <li>
        <a href="http://www.odino.org/install-composer-dependencies-with-the-symfony2-cli/">Using the Console component to write an interactive installer for Composer</a>
    </li>
</ol>


<p>Today we are going to see the power of Symfony2&#8217;s
<a href="https://github.com/symfony/console">Console component</a>,
which lets us build powerful interactive command line applications
in pure PHP.</p>

<!-- more -->


<p><img class="right" src="http://www.odino.org/images/installer.png"></p>

<p>In this episode we are going to create an interactive shell
able to generate new composer-based projects: we will have a
command to define which dependencies we need and another one
to:</p>

<ul>
<li>create the installation directory</li>
<li>download composer</li>
<li>generate  a <code>composer.json</code> according to the required dependencies</li>
<li>run a <code>php composer.phar install</code> to install everything</li>
</ul>


<p>The approach we&#8217;re going to use will be very rough and incomplete: no
error handling, no decent abstraction, but is intended to give you a
clue about the potentiality of the CLI tool and to show you how you can
easily create PHP command line applications without the need to
write too much good code.</p>

<h2>Approach and installation</h2>

<p>The Symfony2 Console lets use extend the <code>Console\Command\Command</code> class to
implement your own commands, so we will add a couple custom commands, one to
<strong>register dependencies</strong> and one to <strong>execute the installation</strong>.</p>

<p>First of all, let create our own <code>composer.json</code>, to download the Console
and <a href="http://www.odino.org/launching-phpunit-tests-from-a-browser-with-symfony2/">Process</a><sup id='fnref:1'><a href='#fn:1' rel='footnote'>1</a></sup>
components:</p>

<figure class='code'><figcaption><span>composer.json</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;require&quot;</span>: <span class="o">{</span>
</span><span class='line'>        <span class="s2">&quot;php&quot;</span>: <span class="s2">&quot;&gt;=5.3.2&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;symfony/console&quot;</span>: <span class="s2">&quot;2.0.10&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;symfony/process&quot;</span>: <span class="s2">&quot;2.0.10&quot;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>then install everything and create your <code>installer.php</code> script which
serves as the entry point for the console:</p>

<figure class='code'><figcaption><span>installing the dependencies</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget http://getcomposer.org/composer.phar
</span><span class='line'>
</span><span class='line'>php composer.phar install
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>installer.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">require</span> <span class="s1">&#39;vendor/.composer/autoload.php&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">require</span> <span class="s1">&#39;Command/DependencyContainer.php&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">require</span> <span class="s1">&#39;Command/Install.php&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\Console\Shell</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\Console\Application</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$application</span>            <span class="o">=</span> <span class="k">new</span> <span class="nx">Application</span><span class="p">(</span><span class="s1">&#39;Installer&#39;</span><span class="p">,</span> <span class="s1">&#39;1.0.0-alpha&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$dependencyContainer</span>    <span class="o">=</span> <span class="k">new</span> <span class="nx">DependencyContainer</span><span class="p">();</span>
</span><span class='line'><span class="nv">$application</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$dependencyContainer</span><span class="p">);</span>
</span><span class='line'><span class="nv">$application</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">Install</span><span class="p">(</span><span class="nv">$dependencyContainer</span><span class="p">));</span>
</span><span class='line'><span class="nv">$shell</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Shell</span><span class="p">(</span><span class="nv">$application</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$shell</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the <code>installer.php</code> we are instantiating a new interactive shell
application, adding to it 2 new commands and then we run it: don&#8217;t try it now,
as the added command classes don&#8217;t exist yet.</p>

<h2>A container for the dependencies</h2>

<p>The first custom command we are going to add is a dependency container, which is
a convenient class storing the dependencies, like <code>symfony/yaml</code>, in an
attribute, and exposes a <code>getDependencies()</code> method that will be used by the
installer command to retrieve the dependencies to install.</p>

<figure class='code'><figcaption><span>Command/DependencyContainer.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\Console\Command\Command</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\Console\Input\InputInterface</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\Console\Output\OutputInterface</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">DependencyContainer</span> <span class="k">extends</span> <span class="nx">Command</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$dependencies</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getDependencies</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dependencies</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">protected</span> <span class="k">function</span> <span class="nf">execute</span><span class="p">(</span><span class="nx">InputInterface</span> <span class="nv">$input</span><span class="p">,</span> <span class="nx">OutputInterface</span> <span class="nv">$output</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$dialog</span>  <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getHelperSet</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;dialog&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$package</span> <span class="o">=</span> <span class="nv">$dialog</span><span class="o">-&gt;</span><span class="na">ask</span><span class="p">(</span><span class="nv">$output</span><span class="p">,</span> <span class="s1">&#39;&lt;question&gt;Please enter the name of the package you want to install&lt;/question&gt;&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nv">$package</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dependencies</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">.</span> <span class="nv">$package</span> <span class="o">.</span> <span class="s1">&#39;&quot;: &quot;master&quot;&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="nv">$output</span><span class="o">-&gt;</span><span class="na">writeln</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;&lt;info&gt;Package %s was succesfully registered&lt;/info&gt;&#39;</span><span class="p">,</span> <span class="nv">$package</span><span class="p">));</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$output</span><span class="o">-&gt;</span><span class="na">writeln</span><span class="p">(</span><span class="s1">&#39;&lt;error&gt;You must insert a package name&lt;/error&gt;&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">protected</span> <span class="k">function</span> <span class="nf">configure</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span>
</span><span class='line'>            <span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="s1">&#39;add-dependency&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you see, the command will be called when doing a <code>add-dependency</code> from the console
and will ask the user to prompt the dependency we wants to add; a basic check is done:</p>

<figure class='code'><figcaption><span>Checking for non-empty input</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nv">$package</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dependencies</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">.</span> <span class="nv">$package</span> <span class="o">.</span> <span class="s1">&#39;&quot;: &quot;master&quot;&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$output</span><span class="o">-&gt;</span><span class="na">writeln</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;&lt;info&gt;Package %s was succesfully registered&lt;/info&gt;&#39;</span><span class="p">,</span> <span class="nv">$package</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$output</span><span class="o">-&gt;</span><span class="na">writeln</span><span class="p">(</span><span class="s1">&#39;&lt;error&gt;You must insert a package name&lt;/error&gt;&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that, for being <em>quick&#8217;n&#8217;dirty</em>, we store the dependencies in the composer way:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="s2">&quot;dependencyvendor/dependencyname&quot;</span>: <span class="s2">&quot;dependencyversion&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>and we use <code>master</code> as the only version available<sup id='fnref:2'><a href='#fn:2' rel='footnote'>2</a></sup>.</p>

<p>This is it: now we only need to create the command to install everything.</p>

<h2>The installation command</h2>

<p>The <code>Install</code> command will be called with <code>install</code> from the command line, and
executes 4 sub-tasks to finish the installation process:</p>

<ul>
<li>create the installation directory</li>
<li>download composer via <code>wget</code></li>
<li>generate the <code>composer.json</code> according to the dependencies specified in the
DependencyContainer</li>
<li>run the composer traditional installation (<code>php composer.phar install</code>)</li>
</ul>


<p>This command takes a <code>DependencyContainer</code> argument in the constructor
to extract the dependencies needed to be installed:</p>

<figure class='code'><figcaption><span>Command/Install.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\Console\Command\Command</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\Console\Output\OutputInterface</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\Console\Input\InputInterface</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\Process\Process</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Install</span> <span class="k">extends</span> <span class="nx">Command</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$installDir</span><span class="p">;</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$failingProcess</span><span class="p">;</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$dependenciesContainer</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">DependencyContainer</span> <span class="nv">$dependenciesContainer</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dependenciesContainer</span> <span class="o">=</span> <span class="nv">$dependenciesContainer</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">protected</span> <span class="k">function</span> <span class="nf">execute</span><span class="p">(</span><span class="nx">InputInterface</span> <span class="nv">$input</span><span class="p">,</span> <span class="nx">OutputInterface</span> <span class="nv">$output</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createInstallationDirectory</span><span class="p">(</span><span class="nv">$output</span><span class="p">)</span>
</span><span class='line'>         <span class="o">&amp;&amp;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">downloadComposer</span><span class="p">(</span><span class="nv">$output</span><span class="p">)</span>
</span><span class='line'>         <span class="o">&amp;&amp;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">generateJson</span><span class="p">(</span><span class="nv">$output</span><span class="p">)</span>
</span><span class='line'>         <span class="o">&amp;&amp;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">install</span><span class="p">(</span><span class="nv">$output</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$output</span><span class="o">-&gt;</span><span class="na">writeln</span><span class="p">(</span><span class="s1">&#39;&lt;info&gt;MISSION ACCOMPLISHED&lt;/info&gt;&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$output</span><span class="o">-&gt;</span><span class="na">writeln</span><span class="p">(</span><span class="s1">&#39;&lt;error&gt;Nasty error happened :\&#39;-(&lt;/error&gt;&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">failingProcess</span> <span class="nx">instanceOf</span> <span class="nx">Process</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$output</span><span class="o">-&gt;</span><span class="na">writeln</span><span class="p">(</span><span class="s1">&#39;&lt;error&gt;%s&lt;/error&gt;&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">failingProcess</span><span class="o">-&gt;</span><span class="na">getErrorOutput</span><span class="p">());</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">protected</span> <span class="k">function</span> <span class="nf">configure</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span>
</span><span class='line'>            <span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="s1">&#39;install&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>as you see we execute this 4 tasks and, if an error happens, we output an error,
otherwise a confirmation message tells the user that everything went fine.</p>

<p>If a failure happens, we get the error message thanks to the <code>Process</code> method <code>getErrorOutput()</code>.</p>

<p>Let&#8217;s see how the tasks are implemented in this class: first of all, we need a <code>createInstallationDirectory()</code>
method that launches a new <code>mkdir</code> process and returns a boolean value, indicating the
successfulness of the process; before returning false, the class&#8217; internal attribute
<code>$failingProcess</code> is updated:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'>
</span><span class='line'><span class="k">protected</span> <span class="k">function</span> <span class="nf">createInstallationDirectory</span><span class="p">(</span><span class="nx">OutputInterface</span> <span class="nv">$output</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$dialog</span>             <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getHelperSet</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;dialog&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">installDir</span>   <span class="o">=</span> <span class="nv">$dialog</span><span class="o">-&gt;</span><span class="na">ask</span><span class="p">(</span><span class="nv">$output</span><span class="p">,</span> <span class="s1">&#39;&lt;question&gt;Please specify a non-existing directory to start the installation&lt;/question&gt;&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">installDir</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$mkdir</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Process</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;mkdir -p %s&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">installDir</span><span class="p">));</span>
</span><span class='line'>        <span class="nv">$mkdir</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nv">$mkdir</span><span class="o">-&gt;</span><span class="na">isSuccessful</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$output</span><span class="o">-&gt;</span><span class="na">writeln</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;&lt;info&gt;Directory %s succesfully  created&lt;/info&gt;&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">installDir</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">failingProcess</span> <span class="o">=</span> <span class="nv">$mkdir</span><span class="p">;</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you see, the user will be asked to provide an <code>$installDir</code> in which we are going
to execute the whole process.</p>

<p>Now we need to create the <code>downloadComposer()</code> method, which uses <code>wget</code> to put <code>composer.phar</code>
in the installation directory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'>
</span><span class='line'><span class="k">protected</span> <span class="k">function</span> <span class="nf">downloadComposer</span><span class="p">(</span><span class="nx">OutputInterface</span> <span class="nv">$output</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$wget</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Process</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;wget getcomposer.org/composer.phar -O %s/composer.phar&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">installDir</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">installDir</span><span class="p">));</span>
</span><span class='line'>    <span class="nv">$wget</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nv">$wget</span><span class="o">-&gt;</span><span class="na">isSuccessful</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$output</span><span class="o">-&gt;</span><span class="na">writeln</span><span class="p">(</span><span class="s1">&#39;&lt;info&gt;Downloaded composer in the installation directory&lt;/info&gt;&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">failingProcess</span> <span class="o">=</span> <span class="nv">$wget</span><span class="p">;</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then we generate a <code>composer.json</code> in the installation directory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'>
</span><span class='line'><span class="k">protected</span> <span class="k">function</span> <span class="nf">generateJson</span><span class="p">(</span><span class="nx">OutputInterface</span> <span class="nv">$output</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$skeleton</span>       <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nx">__DIR__</span> <span class="o">.</span> <span class="s2">&quot;/../composer.s&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$dependencies</span>   <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dependenciesContainer</span><span class="o">-&gt;</span><span class="na">getDependencies</span><span class="p">());</span>
</span><span class='line'>    <span class="nv">$skeleton</span>       <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39;PLACEHOLDER&#39;</span><span class="p">,</span> <span class="nv">$dependencies</span><span class="p">,</span> <span class="nv">$skeleton</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">installDir</span> <span class="o">.</span> <span class="s2">&quot;/composer.json&quot;</span><span class="p">,</span> <span class="nv">$skeleton</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$output</span><span class="o">-&gt;</span><span class="na">writeln</span><span class="p">(</span><span class="s1">&#39;&lt;info&gt;composer.json has been generated&lt;/info&gt;&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that you will need a template file to do so:</p>

<figure class='code'><figcaption><span>composer.s</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;require&quot;</span>: <span class="o">{</span>
</span><span class='line'>        PLACEHOLDER
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The last step consists in launching a new process which runs the
usual composer&#8217;s installation process on the installation directory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'>
</span><span class='line'><span class="k">protected</span> <span class="k">function</span> <span class="nf">install</span><span class="p">(</span><span class="nx">OutputInterface</span> <span class="nv">$output</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$install</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Process</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;cd %s &amp;&amp; php composer.phar install&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">installDir</span><span class="p">));</span>
</span><span class='line'>    <span class="nv">$install</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nv">$install</span><span class="o">-&gt;</span><span class="na">isSuccessful</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$output</span><span class="o">-&gt;</span><span class="na">writeln</span><span class="p">(</span><span class="s1">&#39;&lt;info&gt;Packages succesfully installed&lt;/info&gt;&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">failingProcess</span> <span class="o">=</span> <span class="nv">$install</span><span class="p">;</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is the console output for generating a new project which depends on
<code>symfony/yaml</code> and <code>symfony/dom-crawler</code>:</p>

<p><img class="center" src="http://www.odino.org/images/shell.png"></p>

<p>The auto-generated <code>composer.json</code> will look like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;require&quot;</span>: <span class="o">{</span>
</span><span class='line'>        <span class="s2">&quot;symfony/yaml&quot;</span>: <span class="s2">&quot;master&quot;</span>,<span class="s2">&quot;symfony/dom-crawler&quot;</span>: <span class="s2">&quot;master&quot;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Conclusion</h2>

<p>As said, this implementation is pretty naive and can definitely be improved:
but with a couple classes and basic logic you are able to write a powerful
tool that doesn&#8217;t require a web frontend and runs directly from the command line
with a pure implementation in PHP, thanks to the Symfony2 components.</p>

<div class="footnotes">
<span>
Notes
</span>
    <ol>
        <li id='fn:1'>The Process component will be used to execute shell commands directly from PHP <a href='#fnref:1' rev='footnote'>↩</a></li><li id='fn:2'>Tip: if you want, you can add the code to show the user another dialog to indicate the dependency version, and use master as a fallback <a href='#fnref:2' rev='footnote'>↩</a></li>
    </ol>
</div>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Launching PHPUnit tests from a browser with Symfony2]]></title>
    <link href="http://www.odino.org/launching-phpunit-tests-from-a-browser-with-symfony2/"/>
    <updated>2012-02-20T13:41:00+04:00</updated>
    <id>http://www.odino.org/launching-phpunit-tests-from-a-browser-with-symfony2</id>
    <content type="html"><![CDATA[<ol class="aseries">
    <p>This post is part of the &#8221;<strong>Symfony2 components in your own userland</strong>&#8221; series; here is a list of all the articles contained this series:</p>
    <li>
        <a href="http://www.odino.org/using-the-symfony2-dependency-injection-container-as-a-standalone-component/">Using the Symfony2 Dependency Injection Container as a standalone component</a>
    </li>
    <li>
        <a href="http://www.odino.org/launching-phpunit-tests-from-a-browser-with-symfony2/">Launching PHPUnit tests from a browser with Symfony2</a>
    </li>
    <li>
        <a href="http://www.odino.org/install-composer-dependencies-with-the-symfony2-cli/">Using the Console component to write an interactive installer for Composer</a>
    </li>
</ol>


<p>Today we are going to launch interactive PHPUnit tests thanks to the
Symfony2 <a href="https://github.com/symfony/Process">Process</a> component.</p>

<!-- more -->


<h2>Premise</h2>

<p>This article will show you how to build a script to run your unit tests
from a browser and render the output to the webpage: since the aim
of this series of articles is to show you how easily you can integrate
Symfony2 code into your own projects, I will use nasty scripts to
accomplish our requirements.</p>

<h2>The approach</h2>

<p>Our approach will be very basic and dummy: we are goint to execute a shell
command from PHP, write each output buffers into a file and poll the file
from the frontend to progressively read its content.</p>

<h2>Into the mix</h2>

<p>To do so, let&#8217;s create a JS-loving <code>index.php</code> file:</p>

<figure class='code'><figcaption><span>The entry point of out application</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'>  <span class="nt">&lt;body&gt;</span>
</span><span class='line'>    <span class="nt">&lt;h1&gt;</span>PHPUnit web tests<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">id=</span><span class="s">&quot;run&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      Run tests
</span><span class='line'>    <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;output&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js&quot;</span> <span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">getOutput</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>          <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span class='line'>            <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;output.php&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#output&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">content</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>              <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">stop</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">getOutput</span><span class="p">();</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>          <span class="p">});</span>
</span><span class='line'>        <span class="p">};</span>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#run&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>          <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span class='line'>            <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;process.php&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="p">});</span>
</span><span class='line'>          <span class="nx">getOutput</span><span class="p">();</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you see, as you click on the <code>Run tests</code> link you will fire an event that:</p>

<ul>
<li>makes a <code>GET</code> call to <code>process.php</code></li>
<li>makes a recursive <code>GET</code> request to <code>output.php</code>, until the output object
does not contain the <code>stop</code> attribute</li>
</ul>


<p>The output script is really easy:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$fileName</span> <span class="o">=</span> <span class="nx">sys_get_temp_dir</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;/test.output.txt&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nb">file_exists</span><span class="p">(</span><span class="nv">$fileName</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>  <span class="nv">$f</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nx">sys_get_temp_dir</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;/test.output.txt&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">echo</span> <span class="nx">json_encode</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;content&#39;</span> <span class="o">=&gt;</span> <span class="nv">$f</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="nv">$f</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nx">sys_get_temp_dir</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;/test.output.txt.f&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">echo</span> <span class="nx">json_encode</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;content&#39;</span> <span class="o">=&gt;</span> <span class="nv">$f</span><span class="p">,</span> <span class="s1">&#39;stop&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">));</span>
</span><span class='line'>  <span class="nb">unlink</span><span class="p">(</span><span class="nv">$f</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you see, each time we call this script, it reads the content of the <code>test.output.txt</code>
file in the temporary directory of your system: if it doesn&#8217;t find it, it reads the
<code>test.output.txt.f</code> file<sup id='fnref:1'><a href='#fn:1' rel='footnote'>1</a></sup>.</p>

<h2>Enter Process</h2>

<p>In our final step, let&#8217;s install the Process component:</p>

<figure class='code'><figcaption><span>composer.json</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;require&quot;</span>: <span class="o">{</span>
</span><span class='line'>        <span class="s2">&quot;php&quot;</span>: <span class="s2">&quot;&gt;=5.3.2&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;symfony/process&quot;</span>: <span class="s2">&quot;2.0.10&quot;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>composer.json</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget http://getcomposer.org/composer.phar
</span><span class='line'>
</span><span class='line'>php composer.phar install
</span></code></pre></td></tr></table></div></figure>


<p>then we can create our <code>process.php</code> script:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">require</span> <span class="nx">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/vendor/.composer/autoload.php&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\Process\Process</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$file</span> <span class="o">=</span> <span class="nx">sys_get_temp_dir</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;/test.output.txt&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$handle</span>   <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$process</span>  <span class="o">=</span> <span class="k">new</span> <span class="nx">Process</span><span class="p">(</span><span class="s1">&#39;phpunit -c /home/foor/bar/phpunit.xml /home/foo/bar&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$process</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$type</span><span class="p">,</span> <span class="nv">$buffer</span><span class="p">)</span> <span class="k">use</span><span class="p">(</span><span class="nv">$handle</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$handle</span><span class="p">,</span> <span class="nb">nl2br</span><span class="p">(</span><span class="nv">$buffer</span><span class="p">));</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nb">fclose</span><span class="p">(</span><span class="nv">$handle</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nb">rename</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$file</span> <span class="o">.</span> <span class="s2">&quot;.f&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you see we are launching the test suite and, at each buffer, thanks to a
lambda, we write a new chunk to the file: at the end of the process the
<code>txt</code> file gets renamed, so the <code>output.php</code> script knows that it needs to
notify the frontend that he&#8217;s not required to poll it anymore, adding
the <code>stop</code> attribute to the JSON object it outputs:</p>

<figure class='code'><figcaption><span>fragment of output.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">echo</span> <span class="nx">json_encode</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;content&#39;</span> <span class="o">=&gt;</span> <span class="nv">$f</span><span class="p">,</span> <span class="s1">&#39;stop&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="http://www.odino.org/images/phpunit-process.png"></p>

<h2>Benefits from the Process component</h2>

<blockquote><p>I can do that crap with shell_exec() too!</p></blockquote>


<p>There are some advantages of using Process instead of writing your own command
executor: first of all, if you don&#8217;t want to take care of the subtle <strong>differences
between the different platforms</strong> everything is done for you;
then <strong>error handling becomes very easy</strong> since you are able to catch all the buffers:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$process</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$type</span><span class="p">,</span> <span class="nv">$buffer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;err&#39;</span> <span class="o">===</span> <span class="nv">$type</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">echo</span> <span class="s1">&#39;Something nasty happened&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="nb">syslog</span><span class="p">(</span><span class="nx">LOG_ERR</span><span class="p">,</span> <span class="nv">$buffer</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">echo</span> <span class="nv">$buffer</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>




<div class="footnotes">
<span>
Notes
</span>
    <ol>
        <li id='fn:1'>Flaw here: no error handling when the .f file is not found <a href='#fnref:1' rev='footnote'>↩</a></li>
    </ol>
</div>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using the Symfony2 DIC as a standalone component]]></title>
    <link href="http://www.odino.org/using-the-symfony2-dependency-injection-container-as-a-standalone-component/"/>
    <updated>2012-02-15T20:06:00+04:00</updated>
    <id>http://www.odino.org/using-the-symfony2-dependency-injection-container-as-a-standalone-component</id>
    <content type="html"><![CDATA[<ol class="aseries">
    <p>This post is part of the &#8221;<strong>Symfony2 components in your own userland</strong>&#8221; series; here is a list of all the articles contained this series:</p>
    <li>
        <a href="http://www.odino.org/using-the-symfony2-dependency-injection-container-as-a-standalone-component/">Using the Symfony2 Dependency Injection Container as a standalone component</a>
    </li>
    <li>
        <a href="http://www.odino.org/launching-phpunit-tests-from-a-browser-with-symfony2/">Launching PHPUnit tests from a browser with Symfony2</a>
    </li>
    <li>
        <a href="http://www.odino.org/install-composer-dependencies-with-the-symfony2-cli/">Using the Console component to write an interactive installer for Composer</a>
    </li>
</ol>


<p>The <a href="https://github.com/symfony/symfony/tree/master/src/Symfony/Component">Symfony2 components</a> are powerful libraries that you can easily integrate in your own code: in this article we will se how to integrate the <a href="https://github.com/symfony/DependencyInjection#readme">dependency injection container</a> in a <em>framework-free</em> PHP small library.</p>

<!-- more -->


<h2>Premise</h2>

<p>have you ever heard about the <a href="http://en.wikipedia.org/wiki/QOTD">QOTD protocol</a><sup id='fnref:1'><a href='#fn:1' rel='footnote'>1</a></sup>?</p>

<p>It&#8217;s a <a href="http://www.ietf.org/rfc/std/std23.txt">standard</a> protocol, defined in
<a href="http://tools.ietf.org/html/rfc865">RFC-0865</a>, for a dummy client/server interaction that allows
a server to listen on port 17 and emit a quote in ASCII text whenever a connection
is opened by a client.</p>

<p>To give you an example, try this from the command line<sup id='fnref:1'><a href='#fn:1' rel='footnote'>1</a></sup>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>telnet alpha.mike-r.com 17</span></code></pre></td></tr></table></div></figure>




<blockquote><p>First love is only a little foolishness and a lot of curiosity, no <br/>really self-respecting woman would take advantage of it.</p><footer><strong>George Bernard Shaw</strong> <cite><a href='http://alpha.mike-r.com'>alpha.mike-r.com</a></cite></footer></blockquote>


<p>So today we are going to see how to implement a QOTD script in PHP, using Symfony2&#8217;s
DIC: the mini-library that we are going to write is dummy and really easy, so you won&#8217;t
get lost following its flow; I won&#8217;t use any autoloader - apart for the DIC stuff - so
the code will exactly look like the ancient PHP, the one you daily need to refactor.</p>

<h2>QOTD scripts</h2>

<p>We have 3 scripts that compose our small library; the first one is the entry point:</p>

<figure class='code'><figcaption><span>index.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">require</span> <span class="s1">&#39;QOTD.php&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$qotd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">QOTD</span><span class="p">();</span>
</span><span class='line'><span class="k">echo</span> <span class="nv">$qotd</span><span class="o">-&gt;</span><span class="na">enchantUs</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>and then the QOTD class:</p>

<figure class='code'><figcaption><span>Quotes Of The Day generator class</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">QOTD</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">protected</span> <span class="nv">$wtfMode</span><span class="p">;</span>
</span><span class='line'>  <span class="k">protected</span> <span class="nv">$quotes</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>      <span class="s2">&quot;michael jordan&quot;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>          <span class="s2">&quot;Always turn a negative situation into a positive situation&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;I can accept failure, everyone fails at something. But I can&#39;t accept not trying&quot;</span>
</span><span class='line'>      <span class="p">),</span>
</span><span class='line'>      <span class="s2">&quot;Mahatma Gandhi&quot;</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>          <span class="s2">&quot;A coward is incapable of exhibiting love; it is the prerogative of the brave&quot;</span>
</span><span class='line'>      <span class="p">),</span>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$wtfMode</span> <span class="o">=</span> <span class="k">false</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wtfMode</span> <span class="o">=</span> <span class="nv">$wtfMode</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="k">function</span> <span class="nf">enchantUs</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="nv">$authorQuotes</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">quotes</span><span class="p">[</span><span class="nb">array_rand</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">quotes</span><span class="p">)];</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wtfMode</span> <span class="o">===</span> <span class="k">true</span> <span class="o">&amp;&amp;</span> <span class="nb">is_int</span><span class="p">(</span><span class="nb">time</span><span class="p">(</span><span class="k">true</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="s2">&quot;WTFed!!!&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="nv">$authorQuotes</span><span class="p">[</span><span class="nb">array_rand</span><span class="p">(</span><span class="nv">$authorQuotes</span><span class="p">)];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you see, the implementation is trivial: we have an array of <code>$quotes</code> and in the <code>enchantUs()</code>
method we extract a random quote from that array: note that there is a boolean parameter
- in the constructor - which enables or disables the <code>WTF mode</code>; when the mode is active, if</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="nb">is_int</span><span class="p">(</span><span class="nb">time</span><span class="p">(</span><span class="k">true</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>is true the QOTD class will output <code>WTFed!!!</code> instead of the usual quote from <code>$quotes</code>.</p>

<p>Let&#8217;s say that we also want to creare a class for Michael Jordan&#8217;s quotes:</p>

<figure class='code'><figcaption><span>Michael Jordan quotes</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">JordanQOTD</span> <span class="k">extends</span> <span class="nx">QOTD</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">protected</span> <span class="nv">$quotes</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>      <span class="s2">&quot;michael jordan&quot;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>          <span class="s2">&quot;Always turn a negative situation into a positive situation&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;I can accept failure, everyone fails at something. But I can&#39;t accept not trying&quot;</span>
</span><span class='line'>      <span class="p">),</span>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>which basically restricts the <code>$quotes</code> to MJ&#8217;s ones<sup id='fnref:3'><a href='#fn:3' rel='footnote'>3</a></sup>.</p>

<p>If we want to change the class used to output quotes, we just need to edit the <code>index.php</code>:</p>

<figure class='code'><figcaption><span>index.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">require</span> <span class="s1">&#39;QOTD.php&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">require</span> <span class="s1">&#39;JordanQOTD.php&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$qotd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">JordanQOTD</span><span class="p">();</span>
</span><span class='line'><span class="k">echo</span> <span class="nv">$qotd</span><span class="o">-&gt;</span><span class="na">enchantUs</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Enter Symfony2 Dependency Injection Container</h2>

<p>The boss just told us that we&#8217;ll need to implement some more <em>modes</em> and lots of
person-specific quote classes, with some other logic to decide which QOTD class
to use and so on: your first decision is to try to parametrize the configuration
of the QOTD &#8220;service&#8221;, using a DIC ; although the problem and its design are quite
simple, it would be a good choice to have a single, central point to manage
services used in your code and their configuration.</p>

<p>First of all, create a <code>composer.json</code> file in the root of your project, to manage
the dependency to the DIC:</p>

<figure class='code'><figcaption><span>composer.json</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;require&quot;</span>: <span class="o">{</span>
</span><span class='line'>        <span class="s2">&quot;php&quot;</span>: <span class="s2">&quot;&gt;=5.3.2&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;symfony/dependency-injection&quot;</span>: <span class="s2">&quot;2.0.10&quot;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>then download Composer and install the DIC:</p>

<figure class='code'><figcaption><span>composer.json</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget http://getcomposer.org/composer.phar
</span><span class='line'>
</span><span class='line'>php composer.phar install
</span></code></pre></td></tr></table></div></figure>


<p>Now you can edit the <code>index.php</code> to add some configuration:</p>

<figure class='code'><figcaption><span>index.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">require</span> <span class="nx">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/vendor/.composer/autoload.php&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">require</span> <span class="s1">&#39;QOTD.php&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">require</span> <span class="s1">&#39;JordanQOTD.php&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">require</span> <span class="s1">&#39;container.php&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">echo</span> <span class="nv">$container</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;QOTD&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">enchantUs</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>container.php</code> uses the Symfony2 DIC to register a <code>QOTD</code> service with
a <code>QOTD.mode</code> argument:</p>

<figure class='code'><figcaption><span>configuration of the container</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\ContainerBuilder</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$container</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ContainerBuilder</span><span class="p">();</span>
</span><span class='line'><span class="nv">$container</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">(</span><span class="s1">&#39;QOTD&#39;</span><span class="p">,</span> <span class="s1">&#39;%qotd.class%&#39;</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">addArgument</span><span class="p">(</span><span class="s1">&#39;%QOTD.mode%&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s1">&#39;qotd.class&#39;</span><span class="p">,</span> <span class="s1">&#39;QOTD&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s1">&#39;QOTD.mode&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>For example, we can modify the configuration to enable the WTF mode:</p>

<figure class='code'><figcaption><span>enabling WTF mode</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\ContainerBuilder</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$container</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ContainerBuilder</span><span class="p">();</span>
</span><span class='line'><span class="nv">$container</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">(</span><span class="s1">&#39;QOTD&#39;</span><span class="p">,</span> <span class="s1">&#39;%qotd.class%&#39;</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">addArgument</span><span class="p">(</span><span class="s1">&#39;%QOTD.mode%&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s1">&#39;qotd.class&#39;</span><span class="p">,</span> <span class="s1">&#39;QOTD&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s1">&#39;QOTD.mode&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>or to change the service class, to only output MJ&#8217;s quotes:</p>

<figure class='code'><figcaption><span>changing the service class</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\ContainerBuilder</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$container</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ContainerBuilder</span><span class="p">();</span>
</span><span class='line'><span class="nv">$container</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">(</span><span class="s1">&#39;QOTD&#39;</span><span class="p">,</span> <span class="s1">&#39;%qotd.class%&#39;</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">addArgument</span><span class="p">(</span><span class="s1">&#39;%QOTD.mode%&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s1">&#39;qotd.class&#39;</span><span class="p">,</span> <span class="s1">&#39;JordanQOTD&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s1">&#39;QOTD.mode&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you might understand, with a DIC it&#8217;s possible to drastically <strong>change the
behaviour of your application</strong> editing a configuration file, with a bunch of
additional lines of code into your own application; another great thing is that
you can also use different &#8220;languages&#8221; to configure the DIC, for example YAML.</p>

<p>To do so, add the required dependency to composer:</p>

<figure class='code'><figcaption><span>composer.json</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;require&quot;</span>: <span class="o">{</span>
</span><span class='line'>        <span class="s2">&quot;php&quot;</span>: <span class="s2">&quot;&gt;=5.3.2&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;symfony/dependency-injection&quot;</span>: <span class="s2">&quot;2.0.10&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;symfony/config&quot;</span>: <span class="s2">&quot;2.0.10&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;symfony/yaml&quot;</span>: <span class="s2">&quot;2.0.10&quot;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>composer.json</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>php composer.phar update
</span></code></pre></td></tr></table></div></figure>


<p>then edit the <code>container.php</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\ContainerBuilder</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\Loader\YamlFileLoader</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\Config\FileLocator</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$container</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ContainerBuilder</span><span class="p">();</span>
</span><span class='line'><span class="nv">$container</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">(</span><span class="s1">&#39;QOTD&#39;</span><span class="p">,</span> <span class="s1">&#39;%qotd.mode%&#39;</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">addArgument</span><span class="p">(</span><span class="s1">&#39;%mode%&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">YamlFileLoader</span><span class="p">(</span><span class="nv">$container</span><span class="p">,</span> <span class="k">new</span> <span class="nx">FileLocator</span><span class="p">(</span><span class="nx">__DIR__</span><span class="p">));</span>
</span><span class='line'><span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">load</span><span class="p">(</span><span class="s1">&#39;container.yml&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>and then configure the DIC creating a <code>container.yml</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">services:</span>
</span><span class='line'><span class="x">  QOTD:</span>
</span><span class='line'><span class="x">    class: QOTD</span>
</span><span class='line'><span class="x">    arguments:</span>
</span><span class='line'><span class="x">      mode: true</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://en.wikipedia.org/wiki/INI_file">INI</a> is another - not documented in
<a href="http://symfony.com/doc/current/book/service_container.html">Symfony2&#8217;s docs</a> - option:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\ContainerBuilder</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\Loader\IniFileLoader</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\Config\FileLocator</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$container</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ContainerBuilder</span><span class="p">();</span>
</span><span class='line'><span class="nv">$container</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">(</span><span class="s1">&#39;QOTD&#39;</span><span class="p">,</span> <span class="s1">&#39;%qotd.class%&#39;</span><span class="p">)</span>
</span><span class='line'>          <span class="o">-&gt;</span><span class="na">addArgument</span><span class="p">(</span><span class="s1">&#39;%qotd.mode%&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">IniFileLoader</span><span class="p">(</span><span class="nv">$container</span><span class="p">,</span> <span class="k">new</span> <span class="nx">FileLocator</span><span class="p">(</span><span class="nx">__DIR__</span><span class="p">));</span>
</span><span class='line'><span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">load</span><span class="p">(</span><span class="s1">&#39;container.ini&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="k">[parameters]</span>
</span><span class='line'>  <span class="na">qotd.class</span> <span class="o">=</span> <span class="s">&quot;QOTD&quot;</span>
</span><span class='line'><span class="s">  qotd.mode = 1</span>
</span></code></pre></td></tr></table></div></figure>


<p>There you go: with a few lines you have a completely working instance of the
Symfony2 dependency injection container: organizing dependencies and services&#8217;
instantiation becomes very easy with this kind of layer and, since its
implementation is trivial, I recommend you to gain familiarity with this
component.</p>

<div class="footnotes">
<span>
Notes
</span>
    <ol>
        <li id='fn:1'>Quote Of The Day <a href='#fnref:1' rev='footnote'>↩</a></li><li id='fn:2'>alpha-mike is the only known public service that implements QOTD protocol <a href='#fnref:2' rev='footnote'>↩</a></li><li id='fn:3'>This is not an optimal design for resolving such this kind of thing, but we&#8217;ll use it as it&#8217;s fairly simple to understand <a href='#fnref:3' rev='footnote'>↩</a></li>
    </ol>
</div>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Retrieving raw WHOIS informations in PHP]]></title>
    <link href="http://www.odino.org/retrieving-raw-whois-informations-in-php/"/>
    <updated>2012-02-14T00:58:00+04:00</updated>
    <id>http://www.odino.org/retrieving-raw-whois-informations-in-php</id>
    <content type="html"><![CDATA[<ol class="aseries">
    <p>This post is part of the &#8221;<strong>WHOIS in PHP: consuming the Robowhois API</strong>&#8221; series; here is a list of all the articles contained this series:</p>
    <li>
        <a href="http://www.odino.org/a-php-library-to-retrieve-whois-informations/">A PHP library to retrieve WHOIS informations</a>
    </li>
    <li>
        <a href="http://www.odino.org/retrieving-raw-whois-informations-in-php/">Retrieving raw WHOIS informations in PHP</a>
    </li>
    <li>
        <a href="http://www.odino.org/checking-a-domain-s-availability-with-php/">Checking a domain&#8217;s availability with PHP</a>
    </li>
  <li>
    <a href="http://www.odino.org/y-u-no-access-whois-informations-in-php/">Y U NO access WHOIS informations in PHP?</a>
  </li>
</ol>


<p>After something more than a week I&#8217;m back here with a first implementation of
the PHP library I was <a href="http://www.odino.org/a-php-library-to-retrieve-whois-informations/">talking earlier</a>
to retrieve WHOIS informations with PHP.</p>

<!-- more -->


<p>In the first meeting I had with <a href="http://davidfunaro.com">David</a> we just setup the
environment (Composer, PHPUnit and so on) and today we&#8217;ve release the
<a href="https://github.com/robowhois/robowhois-php-client/tree/0.7.0">first tag</a>
- 0.7.0 - of <a href="https://github.com/robowhois/robowhois-php-client">Robowhois PHP client</a>,
a PHP library to consume <a href="http://robowhois.com">Robowhois</a> APIs.</p>

<h2>Installation</h2>

<p>The library is assembled with <a href="http://www.odino.org/managing-php-dependencies-with-composer/">Composer</a>,
so you only need to follow the canonical steps in order to download the
required dependencies and use it in your own codebase</p>

<figure class='code'><figcaption><span>Installing the Robowhois PHP client from the command line</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git clone git@github.com:robowhois/robowhois-php-client.git
</span><span class='line'>
</span><span class='line'>wget http://getcomposer.org/composer.phar
</span><span class='line'>
</span><span class='line'>php composer.phar install
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>then you can autoload everything through the auto-generated autoloader
provided by Composer:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">require</span> <span class="s1">&#39;vendor/.composer/autoload.php&#39;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Retrieving raw WHOIS responses</h2>

<p>By now we have implemented the most simple API exposed, the <code>whois:index</code>
one, which returns the raw WHOIS informations associated to a domain.</p>

<p>You can take a look at the example at <code>sample/index.php</code> or try it live:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">php sample/index.php</span>
</span></code></pre></td></tr></table></div></figure>


<p>bare in mind that you&#8217;ll need to sign for a free API key up at Robowhois
website (as far as I remember, they provide 500 free request, but the annual
fee for unlimited requests is <strong>very cheap</strong>).</p>

<p>You can also be a bit more creative than the example above:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Robowhois\Robowhois</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Robowhois\Exception</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">require</span> <span class="s1">&#39;vendor/.composer/autoload.php&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$robowhois</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Robowhois</span><span class="p">(</span><span class="s1">&#39;INSERT-YOUR-API-KEY-HERE&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">try</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// same as $robowhois-&gt;whoisIndex(...)-&gt;getContent()</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nv">$robowhois</span><span class="o">-&gt;</span><span class="na">whoisIndex</span><span class="p">(</span><span class="s1">&#39;robowhois.com&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception\Http\Request\Unauthorized</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;WTF did you used a pirated API key?!?!?!&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception\Http\Response\NotFound</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;OMG 404 happened :-|&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception\Http\Response\ServerError</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;Server too drunk to fulfill the request&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Next release</h2>

<p>In the next meeting - probably next monday - we will implement the <code>account</code> API,
used to retrieve informations about the client&#8217;s account - useful for knowing how many
remaining HTTP requests you have, the <code>whois:availability</code> API, to check whether a
domain is available or not, and the <code>whois:record</code> API, identical to the one we
already implemented, but returning a JSON response.</p>

<p>Then&#8230; take a look at the <a href="https://github.com/robowhois/robowhois-php-client/issues">issue tracker</a>
to stay updated about the state of the project: in the next 3 weeks we should
be able to go out with a stable client for y&#8217;all.</p>
]]></content>
  </entry>
  
</feed>
