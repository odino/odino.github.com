
<!doctype html>
<!-- BEGIN _layouts/default.html -->
<html>
	<head>
		<meta charset="utf-8">
		<meta content="Blog of Alex, Vice President - Technology at Namshi in Dubai: writing about Service Oriented Architectures, web APIs and development teams." name="description">
		<meta content="Alessandro Nadalin" name="author">
		<title>Using Emailvision's CampaignCommander APIs from PHP — Alessandro Nadalin</title>
		<link href="/favicon.png" rel="icon">
		<link href="/stylesheets/screen.css" rel="stylesheet">
		<link href="/atom.xml" rel="alternate" title="Alessandro Nadalin" type="application/atom+xml">
		<link href="/stylesheets/prettify-hemisu.css" type="text/css" rel="stylesheet" />
        <link href='http://fonts.googleapis.com/css?family=Cambo' rel='stylesheet' type='text/css'>
	</head>
	<body>
		<div class="wrap">
			<header>
				<div class="navi">
					<ul>
                        <li><a href="/"><i class="icon-home icon-large"></i> Home</a></li>
                        <li><a href="/about"><i class="icon-user icon-large"></i> About</a></li>
                        <li><a href="/conferences"><i class="icon-group icon-large"></i> Conferences</a></li>
                        <li><a href="/blog/archives"><i class="icon-briefcase icon-large"></i> Archives</a></li>
                        <li><a href="/atom.xml"><i class="icon-rss icon-large"></i> RSS</a></li>
					</ul>
				</div>
			</header>
			<!-- BEGIN _layouts/post.html -->

    <header>
        <h1><a href="/using-emailvisions-campaigncommander-apis-from-php/">Using Emailvision's CampaignCommander APIs from PHP</a></h1>
        <time>28 June 2013</time>
    </header>
<div class="entry-content"><p><img class="right" src="/images/emailvision-template.png"></p>

<p>This weekend I finally had the chance to
work a couple hours on the <code>namshi/emailvision</code>
library, which lets you integrate CampaignCommander
as (email) notification solution in your
PHP projects.</p>

<p>I already had a proof-of-concept of this library since weeks,
and it was already pushed to Github, but since I had no
valid API account to do some integration tests, I
could not really &ldquo;publicize&rdquo; it.</p>

<p>Right now I refactored the library and added a couple integration
tests which are working flawlessy, so, in this post, I&rsquo;m
going to show you how easy it is to send emails with
Emailvision&rsquo;s solution directly from PHP.</p>

<!-- more -->


<h2>Installation</h2>

<p>As usual with the latest libraries built for PHP,
the installation can simply be done with composer,
as the library itself is available over
<a href="https://packagist.org/packages/namshi/emailvision">packagist</a>:</p>

<figure class='code'><figcaption><span>composer.json</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="s2">&quot;namshi/emailvision&quot;</span>: <span class="s2">&quot;dev-master&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>then you simply have to run a <code>php composer.phar update</code> and
you can start utilizing it in your codebase (the namespace is
<code>Namshi\Emailvision</code>, as this library has been built in the
context of our company, <a href="http://en-ae.namshi.com">namshi.com</a>).</p>

<p>As of today, the latest stable release is <code>1.0.0</code>, which is the
one we recommend to run in production &ndash; keep an eye on packagist
if we come up with changes, but I bet it won&rsquo;t change that much
in the near future, as emailvision&rsquo;s API is pretty simple.</p>

<h2>Usage</h2>

<p>After you configure transactional email templates in the
CampaignCommander web interface, you just need to keep in mind
(and in your code) the unique identifier and the security tag
of the template; the rest is very straightforward:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Namshi\Emailvision\Client</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$config</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>    <span class="s1">&#39;random&#39;</span>            <span class="o">=&gt;</span> <span class="s1">&#39;UNIQUE_IDENTIFIER&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;encrypt&#39;</span>           <span class="o">=&gt;</span> <span class="s1">&#39;SECURITY_TAG&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;senddate&#39;</span>          <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">\DateTime</span><span class="p">(),</span>
</span><span class='line'>    <span class="s1">&#39;uidkey&#39;</span>            <span class="o">=&gt;</span> <span class="s1">&#39;EMAIL&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;stype&#39;</span>             <span class="o">=&gt;</span> <span class="s1">&#39;NOTHING&#39;</span><span class="p">,</span>
</span><span class='line'><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$emailvisionClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Client</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span>
</span><span class='line'><span class="nv">$emailvisionClient</span><span class="o">-&gt;</span><span class="na">sendEmail</span><span class="p">(</span><span class="s2">&quot;someone@gmail.com&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>The nice thing here is that Emailvision lets you schedule
emails, so you can just play with the <code>senddate</code> parameter
and set it to the future &ndash; just be aware that it needs to
be a <code>DateTime</code> instance:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Namshi\Emailvision\Client</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$date</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\DateTime</span><span class="p">(</span><span class="s1">&#39;2025-01-01 12:45:00&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$config</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>    <span class="s1">&#39;random&#39;</span>            <span class="o">=&gt;</span> <span class="s1">&#39;UNIQUE_IDENTIFIER&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;encrypt&#39;</span>           <span class="o">=&gt;</span> <span class="s1">&#39;SECURITY_TAG&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;senddate&#39;</span>          <span class="o">=&gt;</span>  <span class="nv">$date</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;uidkey&#39;</span>            <span class="o">=&gt;</span> <span class="s1">&#39;EMAIL&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;stype&#39;</span>             <span class="o">=&gt;</span> <span class="s1">&#39;NOTHING&#39;</span><span class="p">,</span>
</span><span class='line'><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$emailvisionClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Client</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span>
</span><span class='line'><span class="nv">$emailvisionClient</span><span class="o">-&gt;</span><span class="na">sendEmail</span><span class="p">(</span><span class="s2">&quot;someone@gmail.com&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>This code will tell CampaignCommander to trigger
the email on the 1st of January 2025, at 12:45.</p>

<h2>Dynamic content in your emails</h2>

<p>If we would stop here, the library would be pretty
useless, since the power of transactional emails
is to be able to serve dynamic content: in fact, the API
allows you to pass as much variables as you want
that can be configured and used in the email templates
you&rsquo;ve created in emailvision&rsquo;s web interface.</p>

<p>To do so, once you call the <code>sendEmail</code> method of the
client, just pass an array of variables (strings) as second
argument:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$emailvisionClient</span><span class="o">-&gt;</span><span class="na">sendEmail</span><span class="p">(</span><span class="s2">&quot;someone@gmail.com&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>  <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Alex!&#39;</span><span class="p">,</span>
</span><span class='line'><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>and then you will start receiving personalized emails:</p>

<p><img class="center" src="/images/emailvision-received.png"></p>

<h2>Running the tests</h2>

<p>Of course, we&rsquo;ve added some unit and <strong>integration</strong>
tests which let us refactor the library and add
functionalities to it without regressions; to run
the test suite, just use <code>phpunit</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> /path/to/namshi/emailvision
</span><span class='line'>
</span><span class='line'>phpunit
</span></code></pre></td></tr></table></div></figure>


<p>You will notice that even though the tests should contain
some actual HTTP calls, they are very fast: this is because,
unless you provide some real credentials for emailvision,
integration tests aren&rsquo;t run by default.</p>

<p>To run them, you will have to create a new dummy email template
on CampaignCommander and store the credentials you get
after saving it and the email address that is going to
receive the test emails in a file named <code>emailvision.config</code>
in your system&rsquo;s temporary folder (you can get it by
running <code>php -r "echo sys_get_temp_dir();"</code>):</p>

<figure class='code'><figcaption><span>/tmp/emailvision.config</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$encrypt</span>  <span class="o">=</span> <span class="s1">&#39;email_template_security_tag&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$random</span>   <span class="o">=</span> <span class="s1">&#39;email_template_unique_id&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$email</span>    <span class="o">=</span> <span class="s1">&#39;your.address@gmail.com&#39;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Enjoy!</p>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'podabedorg';
    (function() {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus</a>.</noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
<!-- END _/layouts/post.html -->
			<footer>
				<center>
	Copyleft <!--[if lte IE 8]><span style="filter: FlipH; -ms-filter: "FlipH"; display: inline-block;"><![endif]--><span style="-moz-transform: scaleX(-1); -o-transform: scaleX(-1); -webkit-transform: scaleX(-1); transform: scaleX(-1); display: inline-block;">©</span><!--[if lte IE 8]></span><![endif]--> 2014 — Alessandro Nadalin
	<address>
	</address>
</center>
			</footer>
		</div>
	</body>
</html>
<!-- END _layouts/default.html -->