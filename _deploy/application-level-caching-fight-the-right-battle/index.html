
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Application-level caching: fight the right battle  - Alessandro Nadalin</title>
  <meta name="author" content="Alessandro Nadalin">

  
  <meta name="description" content="I always receive a funny question, that I want to answer right here, right now, with the usual reply I give to people asking it to me: Why do you &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.odino.org/application-level-caching-fight-the-right-battle">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Alessandro Nadalin" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<script src="/javascripts/custom.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-7407627-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="no-sidebar"   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1 class="hentry" role="title"><a href="/">Application-level caching: fight the right battle </a></h1>
  <p class="article-date">
      Tuesday, 22 November 2011
  </p>
</hgroup>

</header>
  <nav role="navigation"><ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/about">About</a></li>
  <li><a href="/conferences">Conferences</a></li>
  <li><a href="http://twitter.com/_odino_">Twitter</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/atom.xml">RSS</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
<div class="entry-content"><p>I always receive a funny question, that I want to answer right here, right now, with the usual reply I give to people asking it to me:</p>

<blockquote><p>Why do you hate application-level caches?</p></blockquote>

<p>First of all, I don&#8217;t.</p>

<p>And here&#8217;s explained why I don&#8217;t hate AL caches and why I do really hate how developers integrate caching in their applications.</p>

<!-- more -->


<h2>What should we cache</h2>

<p>There are a few aspects of our architecture/application that usually need caching-capabilities to improve performances, and I will analyze each one of them in order to understand whether they fit well in an application cache or not.</p>

<p>To summarize them, here&#8217;s a brief list:</p>

<ul>
<li>finding file on the filesystem</li>
<li>metadata</li>
<li>routing</li>
<li>configuration</li>
<li>non-native data providers</li>
<li>output fragments</li>
</ul>


<h2>Finding files</h2>

<p>An AL cache is really good for finding files on the filesystem: autoloaders are pretty smart ( for example, in PHP, we have the <a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-0.md">PSR-0</a> standard ) so they basically know a set of conventions and calculate the path to a required file: well, the process of calculating that path is really unnecessary when going live on production, because the core of our application is rarely meant to be moved/changed.</p>

<figure class='code'><figcaption><span>autoloading.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">array</span><span class="p">(</span>
</span><span class='line'>  <span class="s1">&#39;Symfony\Component\Finder\Finder&#39;</span> <span class="o">=&gt;</span> <span class="nx">__DIR__</span> <span class="o">.</span><span class="s1">&#39;/src/Symfony/Component/Finder/Finder.php&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="o">...</span>
</span><span class='line'>  <span class="o">...</span>
</span><span class='line'><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Flushing the autoloading cache at every deploy is the solution for those rare scenarios.</p>

<h2>Reading metadata</h2>

<p>When you need to specify metadata on objects, a good solution is recurring to annotations:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Dog</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="sd">/**</span>
</span><span class='line'><span class="sd">   *  @validation(int)</span>
</span><span class='line'><span class="sd">   */</span>
</span><span class='line'>  <span class="k">protected</span> <span class="nv">$age</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>but reading that data can be expensive, since you always need to parse and introspect an entity.</p>

<p>Doctrine2, the infamous PHP ORM, uses <a href="https://github.com/doctrine/common/tree/master/lib/Doctrine/Common/Cache">caching</a> exactly to solve the issue of always reading metadata from objects.</p>

<h2>Routing</h2>

<p>We usually compile YML/XML files for routing ( &#8216;cause they are way easier to read/write ), which means that at every request we parse the URI, parse the routing file and find a match between them.</p>

<p>Reading the routing can be annoying, so we can easily compile down a PHP file with routing rules from the original routing file.</p>

<h2>Can I haz natives?</h2>

<p>As you might understand, a good solution is to cache when we need to face formats which are different from our language: so, for example, from configuration files we can compile - in PHP - arrays, or stuff like that.</p>

<p>Symfony2, for example, add the ability of <a href="http://www.slideshare.net/fabpot/dependency-injection-in-php-5354/100">compiling down the whole dependency injection container</a> from different formats to plain PHP.</p>

<h2>Bad smells, here they come</h2>

<p>So you may wonder why I hate application caches, and <strong>here it comes the tornado</strong>.</p>

<p>We are basically used to think that <strong>caching the output</strong> is just good, and we have those CMSes like Joomla! or Drupal doing that.</p>

<p>Think about how many things you are loosing re-implementing an output caching layer inside your application: your application needs to do the storage of cached files, it needs to calculate dates and evaluate if an HTML fragment have expired or not, it needs to be hit for 2 identical requests and then, the most disturbing thing, you need to add a layer on top of your application.</p>

<p>Adding new layers is bad, because as you add them, you potentially introduce bugs, coupling and limitations to your software: <strong>the more code you write, the more bugs happen</strong>.</p>

<p>Output caching should be done with the HTTP cache, which works at the protocol level: you don&#8217;t have to add any layer to your application ( you only need a good framework ), and whether to cache or not a resource is demanded to the client&#8217;s browser or to the reverse proxy.</p>

<p>In the HTTP cache, you can serve the same response to 1 milion clients just with a stupid reverse proxy; you can serve the same response after identical requests, to a single client, without even making the subsequent requests traverse the internet.</p>

<p>Custom output caches are not capable of doing 1% of what the HTTP cache has proven to be able to do.</p>

<p>Application-level output caches are an antipattern, get over it.</p>
</div>


  <footer>
    <p class="meta">
<!--      
  

<span class="byline author vcard">Posted by <span class="fn">Alessandro Nadalin</span></span>

      








  


<time datetime="2011-11-22T15:01:00+04:00" pubdate data-updated="true">Tuesday, 22 November 2011 at 15:01</time>-->
      

<span class="categories">
  Categories: 
  
    <a class='category' href='/blog/categories/architecture/'>architecture</a>, <a class='category' href='/blog/categories/cache/'>cache</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="https://twitter.com/share" class="twitter-share-button" data-via="_odino_">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/graphdb-in-php-time-for-the-serious-stuff/" title="Previous Post: GraphDB in PHP: time for the serious stuff">&laquo; GraphDB in PHP: time for the serious stuff</a>
      
      
        <a class="basic-alignment right" href="/osidays-2011-wrapup/" title="next Post: OSIDays 2011 wrapup">OSIDays 2011 wrapup &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><script type="text/javascript">
      var disqus_shortname = 'odino';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.odino.org/application-level-caching-fight-the-right-battle/';
        var disqus_url = 'http://www.odino.org/application-level-caching-fight-the-right-battle/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script></div>
  </section>

</div>


    </div>
  </div>
</html>